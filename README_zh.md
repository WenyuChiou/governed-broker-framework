# Governed Broker Framework

**ğŸŒ Language / èªè¨€: [English](README.md) | [ä¸­æ–‡](README_zh.md)**

<div align="center">

**LLM é©…å‹•çš„ Agent-Based Model æ²»ç†ä¸­é–“ä»¶**

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

</div>

---

| **æ„ŸçŸ¥å±¤ (Perception)** | `ContextBuilder` | *æ„Ÿå®˜* | å‹•æ…‹æ•´åˆä»£ç†äººçš„å€‹äººã€ç¤¾äº¤èˆ‡å…¨å±€ç‹€æ…‹ï¼Œç”Ÿæˆå—é™çš„ LLM æç¤ºè©ã€‚ |
| **èªçŸ¥å±¤ (Cognition)** | `SkillBroker` | *æ³•å®˜* | ã€Œæ²»ç†è€…ã€è§’è‰²ï¼Œè² è²¬é©—è­‰ LLM çš„ææ¡ˆæ˜¯å¦ç¬¦åˆå¿ƒç†è¦å‰‡èˆ‡ç‰©ç†é™åˆ¶ã€‚ |
| **è¡Œå‹•å±¤ (Action)** | `SkillRegistry` | *æ†²æ³•* | å®šç¾©ä»£ç†äººæ‰€æœ‰å¯èƒ½çš„å‹•ä½œã€åŠå…¶æ‰€éœ€çš„æˆæœ¬ã€å‰ææ¢ä»¶èˆ‡åŸ·è¡Œæ•ˆæœã€‚ |
| **ç‰©ç†å±¤ (Physics)** | `SimEngine` | *ä¸–ç•Œ* | åŸ·è¡Œç²å‡†çš„å‹•ä½œï¼Œä¸¦æ›´æ–°æ¨¡æ“¬ç’°å¢ƒï¼ˆä¾‹å¦‚ï¼šæ´ªæ°´æ·¹æ²’èˆ‡æå®³è¨ˆç®—ï¼‰ã€‚ |

---

## ğŸ›¡ï¸ æŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ (Challenges & Solutions)

![æŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ](docs/challenges_solutions.png)

| æŒ‘æˆ° | å•é¡Œ | è§£æ±ºæ–¹æ¡ˆ | æ ¸å¿ƒçµ„ä»¶ |
| :--- | :--- | :--- | :--- |
| **å¹»è¦º (Hallucination)** | LLM ç”¢ç”Ÿç„¡æ•ˆæˆ–ä¸å­˜åœ¨çš„å‹•ä½œ | Skill Registry é™åˆ¶åªèƒ½ä½¿ç”¨å·²è¨»å†ŠæŠ€èƒ½ | `SkillRegistry` |
| **è³‡è¨Šä¸å°ç¨±** | LLM ç¼ºä¹ç‹€æ…‹æ„ŸçŸ¥ï¼Œåšå‡ºä¸å¯è¡Œçš„æ±ºç­– | Context Builder æä¾›æœ‰ç•Œçš„çš„å¯è§€å¯Ÿç‹€æ…‹ | `ContextBuilder` |
| **æ±ºç­–ä¸ä¸€è‡´** | çŸ›ç›¾æˆ–ä¸åˆé‚è¼¯çš„é¸æ“‡ | å¤šéšæ®µé©—è­‰å™¨æª¢æŸ¥ PMT å¿ƒç†ä¸€è‡´æ€§ | `Validators` |
| **ç„¡æ³•è¿½è¹¤** | ç„¡æ³•é‡ç¾æˆ–å¯©è¨ˆæ±ºç­–éç¨‹ | å®Œæ•´çš„æ™‚é–“æˆ³è¨˜å¯©è¨ˆè»Œè·¡ | `AuditWriter` |
| **ä¸å—æ§ç‹€æ…‹è®Šæ›´** | ç›´æ¥ä¸”æœªç¶“é©—è­‰çš„ç‹€æ…‹ä¿®æ”¹ | State Manager æ§åˆ¶æ‰€æœ‰ç‹€æ…‹æ›´æ–°èˆ‡æ¬Šé™ | `StateManager` |

---

---

## ğŸ‘¥ å¤šä»£ç†äººç¤¾äº¤æ§‹å¿µï¼ˆã€Œäº”å¤§æ”¯æŸ±ã€ï¼‰

ç‚ºäº†æ”¯æ´è¤‡é›œçš„ç¤¾äº¤æ¨¡æ“¬ï¼Œæˆ‘å€‘å®šç¾©äº† 5 å€‹é©…å‹•ä»£ç†äººæ±ºç­–çš„æ ¸å¿ƒå¿ƒç†æ§‹å¿µã€‚é€™äº›æ˜¯ä»¥æ¨¡çµ„åŒ–çš„ã€Œæ²»ç†æ¢æ¸¬å™¨ã€å¯¦ç¾çš„ï¼š

1.  **å¨è„…æ„ŸçŸ¥ (Threat Perception, TP)**ï¼šåŒ…å«é˜²ç¯„æ„è­˜ã€æ†‚æ…®ç¨‹åº¦èˆ‡é¢¨éšªè­¦è¦ºã€‚
2.  **æ‡‰å°æ„ŸçŸ¥ (Coping Perception, CP)**ï¼šåŒ…å«è‡ªæˆ‘æ•ˆèƒ½ã€èª¿é©æˆæœ¬èˆ‡èª¿é©æ•ˆç‡ã€‚
3.  **åˆ©ç›Šç›¸é—œè€…æ„ŸçŸ¥ (Stakeholder Perception, SP)**ï¼šå°æ”¿åºœã€ä¿éšªå…¬å¸ç­‰æ©Ÿæ§‹çš„ä¿¡ä»»åº¦ã€å°ˆæ¥­åº¦èˆ‡å½±éŸ¿åŠ›çš„çœ‹æ³•ã€‚
4.  **ç¤¾äº¤è³‡æœ¬ (Social Capital, SC)**ï¼šåµŒå…¥ç¤¾äº¤ç¶²çµ¡ä¸­çš„ä¿¡ä»»ã€è¦ç¯„èˆ‡é„°é‡Œè§€å¯Ÿã€‚
5.  **åœ°æ–¹ä¾é™„ (Place Attachment, PA)**ï¼šå°ç•¶å‰å±…ä½åœ°é»çš„æƒ…æ„Ÿèˆ‡ç‰©ç†é€£çµã€‚

---

## ğŸ§© æ¨¡çµ„å¦‚ä½•ä¸²è¯ (æ¨‚é«˜æµç¨‹)

```mermaid
graph LR
    subgraph Perception ["1. æ„ŸçŸ¥å±¤ (ä¸Šä¸‹æ–‡)"]
        CB["ContextBuilder"] --"å±¤ç´š: å€‹äºº/ç¤¾äº¤/ç’°å¢ƒ"--> LLM
    end
    
    subgraph Governance ["2. èªçŸ¥å±¤ (ç¶“ç´€äºº)"]
        LLM --"ææ¡ˆ"--> SB["SkillBroker"]
        SR["SkillRegistry"] --"æ†²æ³•è¦å‰‡"--> SB
        VAL["é©—è­‰å™¨"] --"PMT è¦å‰‡"--> SB
    end
    
    subgraph Execution ["3. ç‰©ç†å±¤ (æ¨¡æ“¬)"]
        SB --"ç²å‡†æŠ€èƒ½"--> SIM["SimulationEngine"]
        SIM --"ç‹€æ…‹è®Šæ›´"--> STATE["AgentState"]
    end
    
    STATE --"åé¥‹"--> CB
```

---

## æŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ

![æŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ](docs/challenges_solutions.png)

| æŒ‘æˆ° | å•é¡Œ | è§£æ±ºæ–¹æ¡ˆ | å…ƒä»¶ |
|------|------|----------|------|
| **å¹»è¦º (Hallucination)** | LLM ç”¢ç”Ÿç„¡æ•ˆæ±ºç­– | Skill Registry é™åˆ¶åªèƒ½ä½¿ç”¨å·²è¨»å†ŠæŠ€èƒ½ | `SkillRegistry` |
| **æ±ºç­–ä¸ä¸€è‡´** | çŸ›ç›¾æˆ–ä¸åˆé‚è¼¯çš„é¸æ“‡ | å¤šéšæ®µé©—è­‰å™¨æª¢æŸ¥å¯é…ç½®è¦å‰‡ | `Validators` |
| **é ˜åŸŸè€¦åˆ** | æ ¸å¿ƒå±¤åŒ…å«ç¡¬ç·¨ç¢¼é‚è¼¯ | é…ç½®é©…å‹•çš„ç·¨æ’èˆ‡é€šç”¨åŸºé¡ | `Core Engine` |
| **ç„¡å¯è¿½æº¯æ€§** | ç„¡æ³•é‡ç¾æˆ–ç¨½æ ¸æ±ºç­– | å®Œæ•´çš„æ™‚é–“æˆ³è¨˜å¯©è¨ˆè»Œè·¡ | `AuditWriter` |
| **éæ§åˆ¶ç‹€æ…‹è®Šæ›´** | ç›´æ¥ã€æœªé©—è­‰çš„ç‹€æ…‹æ›´æ”¹ | State Manager æ§åˆ¶æ‰€æœ‰ç‹€æ…‹æ›´æ–° | `StateManager` |

---

## æ¡†æ¶ vs. ä½¿ç”¨è€…æ“´å…… (Framework vs. User Extension)

ç‚ºäº†ä¿æŒé—œæ³¨é»åˆ†é›¢ï¼ˆSeparation of Concernsï¼‰ï¼Œå°ˆæ¡ˆåˆ†ç‚º **æ¡†æ¶æ ¸å¿ƒ (Framework Core)** å’Œ **ä½¿ç”¨è€…æ“´å…… (User Extension)**ã€‚

### ğŸ› ï¸ æ¡†æ¶æ ¸å¿ƒ (æ ¸å¿ƒç¨‹å¼ç¢¼ï¼Œå»ºè­°ä¸è¦ä¿®æ”¹)
é€™äº›æ¨¡çµ„æä¾›é€šç”¨çš„ç·¨æ’é‚è¼¯ï¼Œæ‡‰ä¿æŒèˆ‡å…·é«”é ˜åŸŸç„¡é—œï¼š
- **`broker/`**: æ ¸å¿ƒè¨»å†Šã€è§£æã€å…§å®¹å»ºæ§‹å’Œå¯©è¨ˆé‚è¼¯ã€‚
- **`simulation/`**: é€šç”¨çš„å¤šå±¤ç‹€æ…‹ç®¡ç†å’Œæ¨¡æ“¬å¾ªç’°ã€‚
- **`providers/`**: LLM é€£æ¥å™¨ (Ollama, OpenAI ç­‰)ã€‚
- **`validators/`**: åŸºç¤ `AgentValidator` å¼•æ“ã€‚

### ğŸ¨ ä½¿ç”¨è€…æ“´å…… (å¯æ ¹æ“šéœ€æ±‚è‡ªè¨‚)
ä½¿ç”¨è€…åœ¨æ­¤è™•å¯¦ç¾ç‰¹å®šçš„æ¨¡æ“¬é ˜åŸŸé‚è¼¯ï¼š
- **`broker/agent_types.yaml`**: å®šç¾©ä»£ç†äººè¨­å®šæª”ã€æŠ€èƒ½å’Œè¡Œç‚ºåƒæ•¸ã€‚
- **`validators/coherence_rules.yaml`**: å®šç¾©é ˜åŸŸå°ˆå±¬çš„ä¸€è‡´æ€§èˆ‡å®‰å…¨è¦å‰‡ã€‚
- **`examples/`**: å¯¦é©—å°ˆå±¬çš„ä»£ç†äººå¯¦ç¾ã€ç’°å¢ƒæ¨¡å‹å’Œæ•¸æ“šã€‚
- **`data/*.csv`**: ä»£ç†äººæ—ç¾¤æ•¸æ“šèˆ‡äººå£çµ±è¨ˆè³‡æ–™ã€‚

---

## Skill Proposal æ ¼å¼

æ¡†æ¶è¦æ±‚ LLM ä»¥**çµæ§‹åŒ–çš„ Skill Proposal æ ¼å¼**è¼¸å‡ºæ±ºç­–ï¼š

```json
{
  "skill": "buy_insurance",
  "parameters": {"duration": 1},
  "reasoning": "ä»Šå¹´æ´ªæ°´é¢¨éšªé«˜..."
}
```

### ç‚ºä½•ä½¿ç”¨ Skill Proposalï¼Ÿ

| é¢å‘ | è‡ªç”±æ ¼å¼ LLM è¼¸å‡º | Skill Proposal |
|------|-------------------|----------------|
| **å¯è§£ææ€§** | éœ€è¦è¤‡é›œçš„ NLP | çµæ§‹åŒ– JSONï¼Œæ˜“æ–¼è§£æ |
| **å¯é©—è­‰æ€§** | ç„¡æ³•é©—è­‰ | Skill Registry æª¢æŸ¥è³‡æ ¼ |
| **å¯è¿½æº¯æ€§** | é›£ä»¥è¨˜éŒ„ | å®Œæ•´å¯©è¨ˆè»Œè·¡ |
| **ç‹€æ…‹å®‰å…¨** | ç›´æ¥è®Šæ›´ | åŸ·è¡Œå‰å·²é©—è­‰ |
| **å¯é‡ç¾æ€§** | éç¢ºå®šæ€§ | ç¢ºå®šæ€§æŠ€èƒ½åŸ·è¡Œ |

### LLM å¦‚ä½•çŸ¥é“å¯ç”¨æŠ€èƒ½ï¼Ÿ

**Context Builder** å°‡å¯ç”¨æŠ€èƒ½æ³¨å…¥æç¤ºè©ä¸­ï¼š

```
ä½ æ˜¯ä¸€å€‹ä»£ç†äººã€‚å¯ç”¨æŠ€èƒ½ï¼š
- buy_insurance: è³¼è²·æ´ªæ°´ä¿éšª (duration: int)
- elevate_house: åŠ é«˜æˆ¿å±‹ (åƒ…èƒ½ä½¿ç”¨ä¸€æ¬¡)
- relocate: é·ç§»åˆ°æ›´å®‰å…¨çš„å€åŸŸ (æ°¸ä¹…)
- do_nothing: ä»Šå¹´ä¸æ¡å–ä»»ä½•è¡Œå‹•

è«‹ä»¥ JSON æ ¼å¼å›è¦†: {"skill": "...", "parameters": {...}, "reasoning": "..."}
```

é€™ç¢ºä¿ LLM åªæœƒæå‡ºå·²è¨»å†Šçš„æŠ€èƒ½ï¼Œç”± Skill Broker é€²è¡Œé©—è­‰ã€‚

### ğŸ”„ é€šç”¨æ¨¡çµ„åŒ–è³‡è¨Šæµ (Universal Modular Information Flow)

æœ¬æ¡†æ¶é€éåš´æ ¼çš„æ•¸æ“šé©…å‹•å¾ªç’°ï¼Œç¢ºä¿ LLM çš„æ±ºç­–æ—¢å…·å‚™ä¸Šä¸‹æ–‡æ„Ÿæ‡‰èƒ½åŠ›ï¼Œåˆç¬¦åˆç‰©ç†èˆ‡é‚è¼¯çš„ä¸€è‡´æ€§ï¼š

1.  **ä¸Šä¸‹æ–‡å»ºæ§‹ (Context Building - è¼¸å…¥)**ï¼š
    -   `StateManager` å¾ä¸‰å€‹è§£è€¦å±¤æå–å³æ™‚æ•¸æ“šï¼š**å€‹äººå±¤**ï¼ˆç§æœ‰ç‹€æ…‹/è¨˜æ†¶ï¼‰ã€**ç¤¾äº¤å±¤**ï¼ˆé„°å±…è§€å¯Ÿï¼‰ä»¥åŠ**å…±äº«/åˆ¶åº¦å±¤**ï¼ˆç’°å¢ƒã€æ”¿ç­–ï¼‰ã€‚
    -   `ContextBuilder` å°‡é€™äº›æ•¸æ“šåˆæˆçµæ§‹åŒ–ã€æœ‰ç•Œçš„æç¤ºè©ï¼ˆPromptï¼‰ï¼Œä¸¦å¾ `SkillRegistry` æ³¨å…¥å¯ç”¨çš„å‹•ä½œé›†ã€‚
2.  **LLM æ±ºç­– (LLM Decision - æè­°)**ï¼š
    -   LLM ç”Ÿæˆ **SkillProposal**â€”â€”ä¸€å€‹çµæ§‹åŒ–çš„ JSON ææ¡ˆï¼ŒåŒ…å«æ‰€é¸å‹•ä½œã€åƒæ•¸ä»¥åŠå¿ƒç†æ¨ç†ï¼ˆå¨è„…/æ‡‰å°è©•ä¼°ï¼‰ã€‚
3.  **å…©éšæ®µæ²»ç† (Two-Tier Governance - éæ¿¾)**ï¼š
    -   **ç¬¬ä¸€éšæ®µï¼šèº«ä»½èˆ‡å‡†å…¥**ï¼šæª¢æŸ¥ä»£ç†äººçš„ç•¶å‰ç‹€æ…‹æ˜¯å¦å…è¨±è©²å‹•ä½œï¼ˆä¾‹å¦‚ï¼šå·²æ¬é·çš„ä»£ç†äººä¸èƒ½è³¼è²·ä¿éšªï¼‰ã€‚
    -   **ç¬¬äºŒéšæ®µï¼šå…ƒæ•¸æ“šèˆ‡ PMT ä¸€è‡´æ€§**ï¼šé©—è­‰æ¨ç†å…§å®¹ï¼ˆå¦‚ `TP_REASON`ï¼‰åœ¨é‚è¼¯ä¸Šæ˜¯å¦æ”¯æŒæœ€çµ‚æ±ºç­–ã€‚
4.  **åŸ·è¡Œèˆ‡å¯©è¨ˆ (Execution & Audit - å½±éŸ¿)**ï¼š
    -   ç²å‡†çš„æŠ€èƒ½ç”± `SimulationEngine` åŸ·è¡Œï¼Œä¸¦æ›´æ–°ç‰©ç†ç’°å¢ƒï¼ˆå¦‚æ‰£é™¤è³‡é‡‘ã€å¥—ç”¨æå®³ï¼‰ã€‚
    -   `AuditWriter` å°‡æ•´å€‹ç®¡ç·šï¼ˆè¼¸å…¥ â†’ æ¨ç† â†’ é©—è­‰çµæœ â†’ æœ€çµ‚ç”¢å‡ºï¼‰è¨˜éŒ„åˆ° **CSV å¯©è¨ˆè»Œè·¡**ä¸­ï¼Œä¾›é«˜è§£æåº¦åˆ†æä½¿ç”¨ã€‚

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ§‹çµ„ä»¶ (é€šç”¨æ¨¡çµ„)

### 1. å¤šå±¤ç´šç‹€æ…‹ç®¡ç†
ç‚ºäº†ç²¾ç¢ºæ¨¡æ“¬ç¤¾æœƒ-ç”Ÿæ…‹ç³»çµ±ï¼Œæˆ‘å€‘å°‡ç‹€æ…‹åŠƒåˆ†ç‚ºä¸‰å€‹ä¸åŒçš„å¯è¦‹æ€§ç¶­åº¦ï¼š

| å±¤æ¬¡ | é¡å‹ | å¯è¦‹æ€§ | èªªæ˜ |
| :--- | :--- | :--- | :--- |
| **å€‹äººå±¤ (Individual)** | ç§æœ‰ | åƒ…é™è‡ªå·± | æ”¶å…¥ã€æ•™è‚²ç¨‹åº¦ã€**æƒ…ç¯€è¨˜æ†¶ (Memory)**ã€èª¿é©ç‹€æ…‹ã€‚ |
| **ç¤¾äº¤å±¤ (Social)** | å¯è§€å¯Ÿ | é„°å±… | ç¤¾äº¤è³‡æœ¬ã€é„°å±…çš„è¿‘æœŸæ±ºç­–ï¼ˆå¦‚ï¼š50% çš„é„°å±…å·²åŠ é«˜æˆ¿å±‹ï¼‰ã€‚ |
| **å…±äº«/åˆ¶åº¦å±¤ (Shared)** | å…¨åŸŸ | æ‰€æœ‰ä»£ç†äºº | æ·¹æ°´åš´é‡ç¨‹åº¦ã€å¹´ä»½ã€è£œåŠ©é‡‘æ°´ä½ã€åˆ¶åº¦ä¿¡ä»»åˆ†æ•¸ã€‚ |

### 2. ç”Ÿç‰©å•Ÿç™¼å¼è¨˜æ†¶å¼•æ“
æˆ‘å€‘çš„ `MemoryEngine` ç®¡ç†ä»£ç†äººå°æ™‚é–“çš„ä¸»è§€æ„ŸçŸ¥ï¼š
-   **è¢«å‹•è¨˜éŒ„**ï¼šæ¯å€‹äº‹ä»¶ï¼ˆæ·¹æ°´ã€ç†è³ ã€é„°é‡Œè®ŠåŒ–ï¼‰éƒ½æœƒè¢«æ¨™è¨˜æ™‚é–“æˆ³ä¸¦å„²å­˜ã€‚
-   **ä¸»å‹•é¡¯è‘—æ€§æª¢ç´¢**ï¼šåœ¨ `context_building` æœŸé–“ï¼Œå¼•æ“æ ¹æ“š **æ»‘å‹•çª—å£** æˆ– **é¡¯è‘—æ€§é–€æª»** æª¢ç´¢ç›¸é—œè¨˜æ†¶ï¼Œç¢ºä¿ä»£ç†äººèƒ½å°éå»çš„å‰µå‚·åšå‡ºåæ‡‰ï¼ŒåŒæ™‚é¿å…ã€Œç„¡é™ä¸Šä¸‹æ–‡ã€å°è‡´çš„éŒ¯èª¤ã€‚

### 3. é›™é©—è­‰å™¨ç³»çµ± (Dual-Validator System)
`SkillBroker` å°‡åˆ¶åº¦èˆ‡å¿ƒç†è¦å‰‡åŠƒåˆ†ç‚ºå…©å€‹é—œéµå±¤ç´šï¼š
-   **åš´æ ¼é©—è­‰å™¨ (Error)**ï¼šæ””æˆªéç‰©ç†æˆ–éæ³•çš„å‹•ä½œï¼ˆä¾‹å¦‚ï¼šé‡è¤‡åŠ é«˜æˆ¿å±‹ï¼‰ã€‚é•è¦æœƒè§¸ç™¼**å¼·åˆ¶æ€§çš„é‚è¼¯é‡è©¦**ä¸¦æä¾›å…·é«”åé¥‹ã€‚
-   **å•Ÿç™¼å¼é©—è­‰å™¨ (Warning)**ï¼šæ¨™è¨˜ã€Œä¸ç†æ€§ã€ä½†ç‰©ç†ä¸Šå¯èƒ½çš„è¡Œç‚ºï¼ˆä¾‹å¦‚ï¼šé«˜å¨è„…æ„ŸçŸ¥å»é›¶è¡Œå‹•ï¼‰ã€‚é€™åœ¨å…è¨±é¡äººå¤šæ¨£æ€§çš„åŒæ™‚ï¼Œç¢ºä¿ç ”ç©¶äººå“¡èƒ½åœ¨å¯©è¨ˆè»Œè·¡ä¸­è¿½è¹¤ç•°å¸¸ã€‚

---

## æ¶æ§‹

### å–®ä»£ç†äººæ¨¡å¼

![å–®ä»£ç†äººæ¶æ§‹](docs/single_agent_architecture.png)

**æµç¨‹**: ç’°å¢ƒ â†’ Context Builder â†’ LLM â†’ Model Adapter â†’ Skill Broker Engine â†’ Validators â†’ Executor â†’ State

### å¤šä»£ç†äººæ¨¡å¼

![å¤šä»£ç†äººæ¶æ§‹](docs/multi_agent_architecture.png)

**æµç¨‹**: Agents â†’ LLM (Skill Proposal) â†’ Governed Broker Layer (Context Builder + Validators) â†’ State Managerï¼ŒåŒ…å«å››å±¤ï¼šIndividual (memory)ã€Social (é„°å±…è§€å¯Ÿ)ã€Shared (ç’°å¢ƒ)ã€Institutional (æ”¿ç­–è¦å‰‡)ã€‚

---

## è¨˜æ†¶èˆ‡èªçŸ¥æ¶æ§‹ (V3 ç‰¹æ€§)

æœ¬æ¡†æ¶ç¾åœ¨åŒ…å«ä¸€å€‹æ˜ç¢ºçš„ **Memory Layer (è¨˜æ†¶å±¤)**ï¼Œä½æ–¼ Governed Broker å’Œ Simulation State ä¹‹é–“ï¼Œå¢å¼·äº†ä»£ç†äººçš„ä¸€è‡´æ€§èˆ‡å­¸ç¿’èƒ½åŠ›ã€‚

### è¨˜æ†¶å…ƒä»¶
*   **Working Memory (å·¥ä½œè¨˜æ†¶)**: çŸ­æœŸå„²å­˜ç•¶ä¸‹ä¸Šä¸‹æ–‡ (ä¾‹å¦‚ï¼šæœ€è¿‘é„°å±…çš„å‹•ä½œã€ä»Šå¹´çš„æ”¿ç­–)ã€‚
*   **Episodic Memory (æƒ…ç¯€è¨˜æ†¶)**: é•·æœŸå„²å­˜é‡è¦äº‹ä»¶çš„æ­·å² (ä¾‹å¦‚ï¼šéå»çš„æ´ªæ°´ç½å®³ã€ç†è³ ç´€éŒ„ã€éå»çš„æ±ºç­–)ã€‚

### è³‡è¨Šæµ
1.  **ä¸»å‹•æª¢ç´¢ (`retrieve()`)**: 
    - åœ¨åšå‡ºæ±ºç­–ä¹‹å‰ï¼Œ**Context Builder** å‘¼å« `retrieve()` ç²å–ç›¸é—œè¨˜æ†¶ã€‚
    - *ç¯„ä¾‹*: "æª¢ç´¢éå» 3 å¹´çš„æ´ªæ°´ç½å®³å’Œç†è³ æˆåŠŸç‡ã€‚"
    - é€™äº›æ•¸æ“šæœƒè¢«æ³¨å…¥åˆ°ç™¼é€çµ¦ LLM çš„ **Bounded Context (æœ‰ç•Œä¸Šä¸‹æ–‡)** ä¸­ã€‚

2.  **è¢«å‹•å„²å­˜ (`add_memory()`)**:
    - ç•¶ **Executor** åŸ·è¡Œå·²é©—è­‰çš„æŠ€èƒ½å¾Œï¼Œè§¸ç™¼ `add_memory()`ã€‚
    - æ±ºç­–ã€çµæœä»¥åŠä»»ä½•é©—è­‰è¨»è¨˜éƒ½æœƒè¢«å„²å­˜ç‚ºæ–°çš„è¨˜æ†¶è»Œè·¡ã€‚
    - *ç¯„ä¾‹*: "æ±ºç­–ï¼šåŠ é«˜æˆ¿å±‹ (ç¬¬ 5 å¹´)ã€‚çµæœï¼šæˆåŠŸã€‚"

### å¢å¼·å‹å¯©è¨ˆ (Audit)
**Audit Writer** æ•æ‰èªçŸ¥éç¨‹çš„å®Œæ•´è»Œè·¡ï¼š
*   **Input**: æä¾›äº†ä»€éº¼ä¸Šä¸‹æ–‡/è¨˜æ†¶ï¼Ÿ
*   **Reasoning**: LLM çš„å…§éƒ¨æ¨ç†æ˜¯ä»€éº¼ï¼Ÿ
*   **Validation**: ææ¡ˆç‚ºä½•è¢«æ¥å—æˆ–æ‹’çµ•ï¼Ÿ
*   **Execution**: å¯¦éš›ç™¼ç”Ÿäº†ä»€éº¼ç‹€æ…‹è®Šæ›´ï¼Ÿ

---

## å¿«é€Ÿé–‹å§‹

```bash
# å®‰è£ä¾è³´
pip install -r requirements.txt

# åŸ·è¡Œç¯„ä¾‹å¯¦é©—
cd examples/skill_governed_flood
python run_experiment.py --model llama3.2:3b --num-agents 100 --num-years 10
```

---

## ğŸ”„ æ¡†æ¶æ¼”é€²

![æ¡†æ¶æ¼”é€²](docs/framework_evolution.png)

**No MCP â†’ MCP v1 â†’ Skill-Governed (v2)**ï¼šæ¼¸é€²å¼å¢åŠ æ²»ç†å±¤ç´šï¼Œå¯¦ç¾å¯é çš„ LLM-ABM æ•´åˆã€‚

---

## æ ¸å¿ƒå…ƒä»¶

#### ä»£ç†äººé¡å‹é…ç½® (`broker/agent_types.yaml`)

æ‰€æœ‰ä»£ç†äººè¨­ç½®éƒ½å·²å¤–éƒ¨åŒ–åˆ° **çµ±ä¸€çš„ YAML é…ç½®** ä¸­ã€‚é€™å…è¨±åœ¨ä¸ä¿®æ”¹ Python ä»£ç¢¼çš„æƒ…æ³ä¸‹æ›´æ”¹ä»£ç†äººè¡Œç‚ºã€‚

```yaml
household:
  # æ­¤ä»£ç†äººé¡å‹çš„æœ‰æ•ˆæŠ€èƒ½
  actions: 
    - id: buy_insurance
      aliases: ["Purchase Insurance"]
    - id: do_nothing
  
  # é€é get_parameters() è¨ªå•çš„é ˜åŸŸå°ˆå±¬åƒæ•¸
  parameters:
    income_threshold: 40000
    damage_threshold: 0.1
    
  # ç”¨æ–¼é©—è­‰çš„ PMT ç†è«–æ§‹å¿µ
  constructs: [TP, CP, SP, SC, PA]
```

#### é€šç”¨ AgentValidator (`validators/agent_validator.py`)

æ¡†æ¶ä½¿ç”¨ **å…ƒæ•¸æ“šé©…å‹•** çš„é©—è­‰ç³»çµ±ã€‚è¦å‰‡åœ¨ `agent_types.yaml` å’Œ `coherence_rules.yaml` ä¸­é…ç½®ã€‚

---

## ç‹€æ…‹ç®¡ç†

### ç‹€æ…‹æ‰€æœ‰æ¬Š (å¤šä»£ç†äºº)

| ç‹€æ…‹é¡å‹ | ç¯„ä¾‹ | ç¯„åœ | è®€å– | å¯«å…¥ |
|----------|------|------|------|------|
| **Individual** | `memory`, `elevated`, `has_insurance` | ä»£ç†äººç§æœ‰ | åƒ…è‡ªå·± | åƒ…è‡ªå·± |
| **Social** | `neighbor_actions`, `last_decisions` | å¯è§€å¯Ÿé„°å±… | é„°å±… | ç³»çµ± |
| **Shared** | `flood_occurred`, `year` | æ‰€æœ‰ä»£ç†äºº | å…¨éƒ¨ | ç³»çµ± |
| **Institutional** | `subsidy_rate`, `policy_mode` | æ‰€æœ‰ä»£ç†äºº | å…¨éƒ¨ | åƒ…æ”¿åºœ |

> **é‡é»**: `memory` æ˜¯ **Individual** - æ¯å€‹ä»£ç†äººæœ‰è‡ªå·±çš„è¨˜æ†¶ï¼Œä¸å…±äº«ã€‚

---

## é©—è­‰ç®¡ç·š

| éšæ®µ | é©—è­‰å™¨ | æª¢æŸ¥ |
|------|--------|------|
| 1 | Admissibility | æŠ€èƒ½å­˜åœ¨ï¼Ÿä»£ç†äººæœ‰è³‡æ ¼ä½¿ç”¨æ­¤æŠ€èƒ½ï¼Ÿ |
| 2 | Feasibility | å‰ç½®æ¢ä»¶æ»¿è¶³ï¼Ÿ(ä¾‹å¦‚ï¼Œå°šæœªåŠ é«˜) |
| 3 | Constraints | ä¸€æ¬¡æ€§ï¼Ÿå¹´åº¦é™åˆ¶ï¼Ÿ |
| 4 | Effect Safety | ç‹€æ…‹è®Šæ›´æœ‰æ•ˆï¼Ÿ |
| 5 | PMT Consistency | æ¨ç†èˆ‡æ±ºç­–ä¸€è‡´ï¼Ÿ |
| 6 | Uncertainty | å›æ‡‰æœ‰ä¿¡å¿ƒï¼Ÿ |

---

## æ¡†æ¶æ¯”è¼ƒ

| ç¶­åº¦ | å–®ä»£ç†äºº | å¤šä»£ç†äºº |
|------|----------|----------|
| ç‹€æ…‹ | åƒ… Individual | Individual + Social + Shared + Institutional |
| ä»£ç†äººé¡å‹ | 1 ç¨® | N ç¨® (å±…æ°‘ã€æ”¿åºœã€ä¿éšªå…¬å¸) |
| å¯è§€å¯Ÿ | åƒ…è‡ªå·± | è‡ªå·± + é„°å±… + ç¤¾å€çµ±è¨ˆ |
| ä¸Šä¸‹æ–‡ | ç›´æ¥ | é€é Context Builder + Social Module |
| ä½¿ç”¨æ¡ˆä¾‹ | åŸºç¤ ABM | å…·ç¤¾æœƒå‹•æ…‹çš„æ”¿ç­–æ¨¡æ“¬ |

---

## æ–‡ä»¶

- [æ¶æ§‹è©³æƒ…](docs/skill_architecture.md)
- [è‡ªè¨‚æŒ‡å—](docs/customization_guide.md)
- [å¯¦é©—è¨­è¨ˆ](docs/experiment_design_guide.md)

---

## æˆæ¬Š

MIT
