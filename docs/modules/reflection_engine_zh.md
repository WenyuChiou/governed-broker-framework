# 組件：反思引擎（Meta-Cognition）

**語言： [English](reflection_engine.md) | [中文](reflection_engine_zh.md)**

記憶系統保存「發生了什麼」，而**反思引擎**產生「為什麼」。它是代理的元認知層，將零散經驗轉化為可行洞見。

---

## 1. 反思機制

### 1.1 從經驗到洞見的迴圈

1. **輸入（情節記憶）**：「第 1 年：洪水」+「第 1 年：投保」  
2. **處理（推理）**：LLM 分析事件與行動的因果  
3. **輸出（語意洞見）**：「洞見：洪水期間保險是財務存續的關鍵」

### 1.2 決策 vs 反思

| 面向 | 決策邏輯（System 1/2） | 反思邏輯（Meta） |
| :--- | :--- | :--- |
| **問題** | 「我現在該做什麼？」 | 「過去的選擇好嗎？」 |
| **時間尺度** | 當下 / 近期 | 過去 / 長期 |
| **機制** | In-Context Learning | 離線批次處理 |
| **輸出** | 行動 | 洞見 |

沒有反思，代理只能「聰明但靜態」；有反思，代理可持續演化。

---

## 2. 反思的理論效益

### 2.1 雙回路學習（Argyris & Schon）

- **單回路**：修正行動以達成目標  
- **雙回路**：反思目標是否合理（例如是否應該遷移）

### 2.2 認知經濟（地圖 vs 真實）

- 原始情節記憶像「真實地形」，搜尋昂貴  
- 反思將大量事件壓縮成少數規則（「地圖」）

### 2.3 噪音過濾

反思類似**低通濾波器**，忽略一次性異常，放大一致趨勢。

### 2.4 對照結果：「金魚」vs「策略家」

| 指標 | 無反思（僅 System 1/2） | 有反思（Meta） |
| :--- | :--- | :--- |
| **反應模式** | 反覆恐慌/鬆懈 | 發現趨勢後改變策略 |
| **記憶限制** | 指數衰減 | 洞見通常 `retention=1.0` |
| **效率** | 每年重算具體事件 | 只取一條規則 |
| **盲點** | 溫水煮青蛙效應 | 趨勢偵測 |

---

## 3. 實務案例：反思迴圈（Input → Process → Output）

#### **1. 輸入：零散記憶**

- **Year 1**：「洪水，未採取行動」→ $10k 損失  
- **Year 3**：「洪水，投保」→ $0 損失  
- **Year 4**：「鄰居 A 抬升，鄰居 B 遷移」

#### **2. 處理：推理整合**

> 「洪水頻繁（Y1、Y3），不行動會導致損失；保險能減少損失，但鄰居開始採取長期措施。」

#### **3. 輸出：語意洞見**

- **洞見 A**：「不作為在此地區財務風險高」  
- **洞見 B**：「保險是短期保護，抬升是長期解法」

---

## 4. 觸發式反思（Task-059）

### 4.1 觸發類型

- **意外驚奇**：超過閾值的驚奇度觸發  
- **長期低效**：行為未改善則觸發  
- **社會漂移**：群體行為偏移觸發

### 4.2 配置

```yaml
reflection_config:
  trigger_mode: "event"
  surprise_threshold: 0.6
```

### 4.3 理論動機

觸發式反思可避免每步驟都反思，僅在「關鍵轉折」時投入計算資源。

---

## 5. 設定與參考文獻

```yaml
reflection_config:
  interval: 1 # 每年反思
  importance_boost: 0.9 # 洞見更「黏」
```

### 參考文獻

[1] Schon (1983). _The Reflective Practitioner_  
[2] Dewey (1933). _How We Think_  
[3] Argyris (1976). _Single-Loop and Double-Loop Models_  
[4] Bandura (1977). _Social Learning Theory_  
[5] Park et al. (2023). _Generative Agents_  
[6] Kahneman (2011). _Thinking, Fast and Slow_
