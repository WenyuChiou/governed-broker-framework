# çµ„ä»¶èªªæ˜ï¼šè¨˜æ†¶ã€ä¸Šä¸‹æ–‡èˆ‡åæ€ (Components: Memory, Context & Reflection)

**ğŸŒ Language: [English](memory_components.md) | [ä¸­æ–‡](memory_components_zh.md)**

æœ¬æ–‡æª”è©³ç´°èªªæ˜äº†ä»£ç†äººçš„èªçŸ¥æ¶æ§‹è¨­è¨ˆï¼Œæ—¨åœ¨åˆ©ç”¨å¿ƒç†å­¸åŸç†è§£æ±º LLM çš„ã€Œé‡‘é­šè…¦æ•ˆæ‡‰ (Goldfish Effect)ã€ã€‚

---

## 1. æ ¸å¿ƒæ¦‚å¿µèˆ‡å®šç¾© (Core Concepts & Definitions)

åœ¨æ·±å…¥ä»£ç¢¼ä¹‹å‰ï¼Œäº†è§£èªçŸ¥è¡“èªåŠå…¶å­¸è¡“åŸºç¤è‡³é—œé‡è¦ã€‚

- **ä»¥äººç‚ºæœ¬çš„è¨˜æ†¶ (Human-Centric Memory)**ï¼šä¸€ç¨®å„ªå…ˆè™•ç†ã€Œæƒ…æ„Ÿé¡¯è‘—æ€§ (Emotional Salience)ã€ï¼ˆå¦‚å‰µå‚·/é‡å¤§äº‹ä»¶ï¼‰è€Œéåƒ…åƒ…æ˜¯æ™‚é–“æ–°è¿‘åº¦çš„æª¢ç´¢æ©Ÿåˆ¶ã€‚å®ƒæ¨¡æ“¬äº†äººé¡çš„å¯å¾—æ€§æ·æ€ã€‚
  - _åƒè€ƒæ–‡ç»_ï¼š**Park, J. S., et al.** (2023). Generative Agents: Interactive Simulacra of Human Behavior.
- **æœ‰ç•Œä¸Šä¸‹æ–‡ (Bounded Context)**ï¼šLLM æ³¨æ„åŠ›çš„ç‰©ç†é™åˆ¶ã€‚æˆ‘å€‘ç„¡æ³•é¤µå…¥ 10 å¹´çš„æ—¥èªŒï¼›æˆ‘å€‘å¿…é ˆå»ºæ§‹ä¸€å€‹é©åˆ Token çª—å£çš„ã€Œç¾å¯¦æ¡†æ¶ã€ã€‚
- **åæ€ (Reflection)**ï¼šä¸€ç¨®å…ƒèªçŸ¥éç¨‹ï¼Œä»£ç†äººå›é¡§å…¶æ­·å²ä»¥å½¢æˆé«˜å±¤æ¬¡çš„ã€Œæ´å¯Ÿ (Insights)ã€ï¼ˆä¾‹å¦‚ï¼šã€Œæˆ‘ä½åœ¨æ´ªæ°´å€ã€ï¼‰ã€‚
  - _åƒè€ƒæ–‡ç»_ï¼š**Shinn, N., et al.** (2023). Reflexion: Language Agents with Verbal Reinforcement Learning.
- **ä¿è­·å‹•æ©Ÿ (PMT)**ï¼šé©…å‹•ä»£ç†äººæ±ºç­–çš„å¿ƒç†å­¸ç†è«–ï¼Œå¹³è¡¡ã€Œå¨è„…æ„ŸçŸ¥ã€èˆ‡ã€Œæ‡‰å°è©•ä¼°ã€ã€‚
  - _åƒè€ƒæ–‡ç»_ï¼š**Rogers, R. W.** (1975). A Protection Motivation Theory.

---

## 2. ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹ (System Design & Architecture)

### ğŸ§  è¨˜æ†¶å¼•æ“ï¼šå›æ†¶çš„ç§‘å­¸

`MemoryEngine` æ˜¯ä¸€å€‹ **é‡æ§‹éç¨‹ (Reconstructive Process)**ã€‚å®ƒåœ¨ Prompt è®Šå¾—æœ‰æ„ç¾© _ä¹‹å‰_ ä½œç‚ºéæ¿¾å™¨é‹ä½œã€‚

**æ•¸å­¸å…¬å¼å®šç¾© (Mathematical Formulation)**

`HumanCentricMemoryEngine` çš„æª¢ç´¢è©•åˆ† $S$ æ¡ç”¨ **è¡°æ¸›åŠ æ¬Šä¹˜ç©** æ¨¡å‹ï¼š

$$ S(m, t) = Imp(m) \cdot e^{-\lambda' \cdot \Delta t} $$

å…¶ä¸­ï¼š

- $Imp(m) = W_{emotion} \times W_{source}$
- $\lambda'$ æ˜¯ç¶“æƒ…æ„Ÿä¿®æ­£å¾Œçš„è¡°æ¸›ç‡ï¼š
  $$ \lambda' = \lambda*{base} \cdot (1 - 0.5 \cdot W*{emotion}) $$
  _(æ„ç¾©ï¼šæƒ…æ„Ÿè¶Šå¼·çƒˆçš„è¨˜æ†¶ï¼Œéºå¿˜é€Ÿåº¦è¶Šæ…¢)_

_æ³¨æ„ï¼šæœ¬ç³»çµ±ä¸ä½¿ç”¨ $\alpha, \beta, \gamma$ ç·šæ€§åŠ æ¬Šåƒæ•¸ã€‚_

### ğŸ‘ï¸ ä¸Šä¸‹æ–‡å»ºæ§‹å™¨ï¼šèªçŸ¥é€é¡

`ContextBuilder` è² è²¬æ¡†æ¶åŒ–ç¾å¯¦ä»¥é˜²æ­¢ **å¹»è¦º**ã€‚å®ƒç‚ºæ¯å€‹ Prompt å»ºæ§‹åš´æ ¼çš„ Schemaï¼š

1.  **å…¨å±€çœŸç†**ï¼šã€Œä½ æ˜¯ä¸€ä½å±‹ä¸»ã€‚ã€(èº«åˆ†èªåŒ)
2.  **æª¢ç´¢è¨˜æ†¶**ï¼šã€Œä½ å›æƒ³èµ·ç¬¬ 2 å¹´çš„æ´ªæ°´ã€‚ã€(ä¾†è‡ªè¨˜æ†¶å¼•æ“)
3.  **ç•¶å‰ç‹€æ…‹**ï¼šã€Œç›®å‰æ°´ä½ï¼š1.5mã€‚ã€(æ„Ÿæ¸¬å™¨)
4.  **ç¤¾äº¤ä¿¡è™Ÿ**ï¼šã€Œé„°å±…è³¼è²·äº†ä¿éšªã€‚ã€(åŒå„•å½±éŸ¿)

### ğŸª åæ€å¼•æ“ï¼šé•·æœŸå¿«å–

åœ¨æ¯å€‹æ¨¡æ“¬å¹´ä»½çµæŸæ™‚ï¼ˆã€Œç¡çœ ã€éšæ®µï¼‰åŸ·è¡Œã€‚

1.  **èšåˆ (Aggregate)**ï¼šè®€å–æ‰€æœ‰æ¯æ—¥æ—¥èªŒã€‚
2.  **åˆæˆ (Synthesize)**ï¼šLLM ç”Ÿæˆ 3 å€‹é«˜å±¤æ¬¡è¦é»ï¼ˆæ´å¯Ÿï¼‰ã€‚
3.  **å›ºåŒ– (Consolidate)**ï¼šæ´å¯Ÿä»¥ `Importance=10` å­˜å…¥è¨˜æ†¶ï¼Œç¢ºä¿æ°¸ä¹…ä¿å­˜ã€‚

---

### 2.5 è¨˜æ†¶æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ(Memory Formation)

ç³»çµ±ä¸­æœ‰å…©æ¢è·¯å¾‘å¯ä»¥ç”¢ç”Ÿã€Œè¨˜æ†¶ã€ï¼Œå®ƒå€‘çš„ç”Ÿæˆæ–¹å¼å®Œå…¨ä¸åŒï¼š

**è·¯å¾‘ Aï¼šç›´æ¥ç¶“é©— (Direct Experience)** â€” **é LLM ç”Ÿæˆ**

- **ä¾†æº**ï¼šæ¨¡æ“¬å™¨çš„å®¢è§€ç‹€æ…‹ï¼ˆä¾‹å¦‚ï¼šã€Œæ°´ä½ = 2.0ftã€ã€ã€Œå¸³æˆ¶æ‰£é™¤ $5000ã€ï¼‰ã€‚
- **å½¢å¼**ï¼šé€™æ˜¯ä¸€æ¢**åŸå§‹äº‹å¯¦ (Raw Fact)**ã€‚
- **éç¨‹**ï¼šç³»çµ±ç›´æ¥å°‡é€™äº›äº‹å¯¦è½‰éŒ„ç‚ºæ–‡å­—ï¼ˆTemplate-Basedï¼‰ï¼Œç„¶å¾Œä¸Ÿé€²æ­£å‰‡æƒæå™¨ (Regex) è©•åˆ†ã€‚
- **ç‰¹é»**ï¼šå¿«é€Ÿã€å®¢è§€ã€ä¸æœƒæœ‰å¹»è¦ºã€‚

**è·¯å¾‘ Bï¼šåæ€æ´å¯Ÿ (Reflected Insights)** â€” **ç”± LLM ç”Ÿæˆ**

- **ä¾†æº**ï¼šä»£ç†äººã€Œç¡è¦ºæ™‚ã€å›é¡§éå»ä¸€å¹´çš„æ—¥èªŒã€‚
- **å½¢å¼**ï¼šé€™æ˜¯ LLM å¯«çš„**å¿ƒå¾—ç¸½çµ**ã€‚
- **éç¨‹**ï¼š
  1.  Python æ”¶é›†ä¸€æ•´å¹´çš„ Logã€‚
  2.  å°‡ Log é¤µçµ¦ `reflection_engine` (LLM)ã€‚
  3.  Prompt: _"What are the 3 most critical lessons you learned this year?"_
  4.  LLM å›ç­”: _"I realized that floods are becoming frequent and my savings are low."_
  5.  é€™æ®µ**LLM å¯«çš„è©±**è¢«å­˜å…¥è¨˜æ†¶åº«ï¼Œä¸¦è³¦äºˆæ¥µé«˜æ¬Šé‡ã€‚

### 2.6 é—œæ–¼é—œéµå­— `%` çš„ç‰¹æ®Šè¨­è¨ˆ

åœ¨ `agent_types.yaml` ä¸­ï¼Œæ‚¨æœƒçœ‹åˆ°ï¼š
`community: ["%", "residents", "community"]`

**ç‚ºä»€éº¼æœƒæœ‰ `%` ç¬¦è™Ÿï¼Ÿ**
é€™æ˜¯ä¸€å€‹å•Ÿç™¼å¼ (Heuristic) è¨­è¨ˆï¼Œç”¨ä¾†æ•æ‰**çµ±è¨ˆæ•¸æ“š**ã€‚

- ç•¶è¼¸å…¥æ–‡å­—æ˜¯ï¼šã€Œ**80%** of your neighbors bought insurance.ã€
- æ­£å‰‡æƒæå™¨çœ‹åˆ° `%` ç¬¦è™Ÿã€‚
- **åˆ¤å®š**ï¼šé€™ä¸æ˜¯ã€Œå€‹äººæ•…äº‹ã€ï¼Œé€™æ˜¯ã€Œç¾¤é«”æ•¸æ“š (Community Data)ã€ã€‚
- **æ¬Šé‡**ï¼šè³¦äºˆ 0.6 çš„æ¬Šé‡ï¼ˆä½æ–¼å€‹äººå‰µå‚·ï¼Œä½†é«˜æ–¼æ™®é€šé–’èŠï¼‰ã€‚

é€™ç¨®è¨­è¨ˆè®“æˆ‘å€‘ä¸éœ€è¦ç”¨æ˜‚è²´çš„ AI å»åˆ†æå¥å­èªç¾©ï¼Œåªè¦çœ‹åˆ°ç™¾åˆ†æ¯”ç¬¦è™Ÿï¼Œå°±å‡è¨­å®ƒæ˜¯ç¤¾æœƒçµ±è¨ˆè³‡è¨Šã€‚

---

### 2.7 å®Œæ•´æ•…äº‹ç¯„ä¾‹ï¼šè¨˜æ†¶çš„ç”Ÿå‘½é€±æœŸ (Life of a Memory)

æˆ‘å€‘åŒæ™‚ä½¿ç”¨ **Path A (ç¶“é©—)** å’Œ **Path B (åæ€)**ã€‚å…©è€…äº’è£œã€‚
è®“æˆ‘å€‘çœ‹ä¸€å€‹å…·é«”çš„æ•…äº‹ï¼Œèªªæ˜è¨˜æ†¶å¦‚ä½•å¾ç™¼ç”Ÿåˆ°è¢«æª¢ç´¢ï¼š

#### ç¬¬ä¸€å¹•ï¼šç™¼ç”Ÿ (Year 2) - çŸ­æœŸè¨˜æ†¶èˆ‡ Path A

- **äº‹ä»¶**ï¼šæ¨¡æ“¬å™¨ç”¢ç”Ÿäº‹ä»¶ã€ŒHigh Flood (Depth: 5.0ft) causes $50k damage.ã€
- **çŸ­æœŸè¨˜æ†¶ (Short-Term)**ï¼šé€™å¥è©±é€²å…¥äº†ç•¶å‰çš„ Context Windowã€‚ä»£ç†äººåšå‡ºåæ‡‰ï¼šã€Œæˆ‘å¾ˆå®³æ€•ï¼Œæˆ‘æ±ºå®šç„¡æ‰€ä½œç‚º (Do Nothing)ã€‚ã€
- **Path A é‹ä½œ (å›ºåŒ–)**ï¼š
  - ç³»çµ± Regex æƒæåˆ°é—œéµå­— "flood" (Weight 1.0) å’Œ "damage" (Weight 1.0)ã€‚
  - è¨ˆç®—é‡è¦æ€§ $I = 1.0$ã€‚
  - å› ç‚º $1.0 > 0.6$ (é–¾å€¼)ï¼Œé€™æ¢é—œæ–¼æ´ªæ°´çš„**åŸå§‹äº‹å¯¦**è¢«ç«‹å³å¯«å…¥ `long_term_memory.json`ã€‚

#### ç¬¬äºŒå¹•ï¼šåæ€ (Year 2 å¹´æœ«) - Path B

- **ç¡çœ éšæ®µ**ï¼šä¸€å¹´çµæŸäº†ã€‚Reflection Engine è®€å–é€™å¹´çš„æ—¥èªŒã€‚
- **Prompt**ï¼šã€Œå›é¡§é€™ä¸€å¹´ï¼Œä½ å­¸åˆ°äº†ä»€éº¼ï¼Ÿã€
- **LLM å›ç­”**ï¼šã€Œæˆ‘ç™¼ç¾æˆ‘çš„å®¶å¦‚æœä¸å¢Šé«˜ï¼Œå¾ˆå¿«å°±æœƒç ´ç”¢ã€‚ã€(Insight)
- **Path B é‹ä½œ**ï¼šé€™æ¢ç”± LLM ç”Ÿæˆçš„**æ™ºæ…§**è¢«å¯«å…¥ `long_term_memory.json`ï¼Œä¸¦è³¦äºˆè¶…é«˜æ¬Šé‡ ($I = 10.0$)ã€‚

#### 3.7 é€²éšæ©Ÿåˆ¶å•ç­” (Advanced Mechanics)

**Q1: ä¸ç†æ€§ (Irrationality) æœƒè¢«æŠ“åˆ°å—ï¼Ÿ**

- **æœƒçš„ã€‚** é€™æ˜¯ `Thinking Rules` çš„è·è²¬ã€‚
- å¦‚æœä»£ç†äººçš„æ€è€ƒé‚è¼¯æ˜¯ï¼šã€Œé›–ç„¶æ´ªæ°´ä¾†äº†ï¼Œä½†æˆ‘æ‡¶å¾—å‹•ã€‚ã€
- Validator æœƒæ ¹æ“š PMT è¦å‰‡æ””æˆªå®ƒï¼šã€ŒéŒ¯èª¤ï¼šå¿…é ˆè©•ä¼°å¨è„…ã€‚ã€
- å› æ­¤ï¼Œæˆ‘å€‘çš„æ¡†æ¶ç¢ºä¿äº†ä»£ç†äºº**è‡³å°‘åœ¨å½¢å¼ä¸Š**æ˜¯ç†æ€§çš„ã€‚

**Q2: è¨˜æ†¶è¡°é€€ (Decay) å° Semantic å’Œ Episodic éƒ½æœ‰æ•ˆå—ï¼Ÿ**

- **æ˜¯çš„ï¼Œå…¬å¼å°æ‰€æœ‰é•·æœŸè¨˜æ†¶éƒ½é©ç”¨ã€‚**
  - $Score = Importance \times e^{-\lambda t}$
- **ä½†æ˜¯**ï¼Œå› ç‚º Semantic (æ™ºæ…§) çš„åˆå§‹åˆ†æ•¸æ¥µé«˜ ($I=10.0$)ï¼Œè€Œ Episodic (äº‹ä»¶) åˆå§‹åˆ†æ•¸è¼ƒä½ ($I=1.0$)ã€‚
- **çµæœ**ï¼š
  - **äº‹ä»¶** (Episodic)ï¼šç´„ 5-8 å¹´å¾Œæœƒè¡°æ¸›åˆ°è¢«éºå¿˜ã€‚
  - **æ™ºæ…§** (Semantic)ï¼šå³ä½¿è¡°æ¸›äº† 20 å¹´ï¼Œåˆ†æ•¸å¯èƒ½é‚„æœ‰ 2.0ï¼Œä¾ç„¶é«˜æ–¼é–¾å€¼ã€‚
  - é€™æ¨¡æ“¬äº†äººé¡ï¼šå¿˜äº†å°æ™‚å€™ç™¼ç”Ÿä»€éº¼äº‹ (äº‹ä»¶å¿˜è¨˜)ï¼Œä½†è¨˜å¾—"ç©ç«æœƒå°¿åºŠ" (æ™ºæ…§æ°¸å­˜)ã€‚

**Q3: ç›®å‰ä½¿ç”¨å‘é‡åŒ– (Vectorization/Embeddings) å—ï¼Ÿ**

- **ç›®å‰æ²’æœ‰ã€‚** æˆ‘å€‘ç›®å‰ä½¿ç”¨çš„æ˜¯ **Keyword-Based Weighted Scoring (é—œéµå­—åŠ æ¬Šè¨ˆåˆ†)**ã€‚
- **ç‚ºä»€éº¼ä¸æ˜¯ Cosine Similarityï¼Ÿ**
  - åœ¨ç¤¾æœƒæ¨¡æ“¬ä¸­ï¼Œã€Œå¿ƒç†å‰µå‚· (Trauma)ã€æ¯”ã€Œèªæ„ç›¸ä¼¼ (Semantic Similarity)ã€æ›´é‡è¦ã€‚
  - ä¾‹å¦‚ï¼šå¦‚æœæ˜¯ç”¨ç›¸ä¼¼åº¦ï¼Œå• "ä»Šå¤©å¤©æ°£å¦‚ä½•" å¯èƒ½æœƒæª¢ç´¢åˆ° "é‚£å¹´å¤©æ°£å¾ˆå¥½"ã€‚
  - ä½†æˆ‘å€‘çš„ **Importance æ¼”ç®—æ³•** æœƒå¼·åˆ¶æª¢ç´¢ "é‚£å¹´ç™¼äº†å¤§æ°´"ï¼Œå› ç‚ºé‚£æ˜¯å‰µå‚·ï¼Œé€™æ¯”å–®ç´”çš„èªæ„ç›¸ä¼¼æ›´ç¬¦åˆå¿ƒç†å­¸æ¨¡å‹ã€‚

#### 3.5 é©—è­‰å¤±æ•— (Validation Failures) æœƒè¢«è¨˜ä½å—ï¼Ÿ

**Q: å¦‚æœä»£ç†äººæƒ³ä½œå¼Šè¢« Governance æ“‹ä¸‹ï¼Œé€™ä»¶äº‹æœƒè¢«è¨˜ä½å—ï¼Ÿ**
**A: çŸ­æœŸæœƒï¼Œé•·æœŸä¸æœƒ (Short-term Yes, Long-term No)ã€‚**

1.  **ç•¶ä¸‹ (Retry Loop)**ï¼š**æœƒè¨˜ä½**ã€‚
    - é©—è­‰å™¨æœƒç«‹åˆ»å›å‚³éŒ¯èª¤ï¼šã€Œä½ éŒ¢ä¸å¤ ï¼Œè«‹é‡é¸ã€‚ã€
    - LLM åœ¨ç•¶ä¸‹çš„ `Context Window` è£¡çœ‹å¾—åˆ°é€™å€‹éŒ¯èª¤ï¼Œæ‰€ä»¥å®ƒèƒ½ä¿®æ­£ä¸¦é‡è©¦ã€‚
2.  **éš”å¹´ (Long-Term Memory)**ï¼š**ä¸æœƒè¨˜ä½**ã€‚
    - ä¸€æ—¦é€™ä¸€å›åˆçµæŸï¼Œæˆ‘å€‘æœƒæŠŠé‚£äº›ã€Œå˜—è©¦éŒ¯èª¤ã€çš„å°è©±ç´€éŒ„**ä¸Ÿæ£„**ã€‚
    - æˆ‘å€‘åªå°‡**æœ€çµ‚æˆåŠŸ**çš„çµæœå¯«å…¥é•·æœŸè¨˜æ†¶åº«ã€‚
    - _åŸå› _ï¼šç‚ºäº†ç¯€çœ Tokenï¼Œä¹Ÿæ¨¡æ“¬äººé¡å‚¾å‘æ–¼è¨˜ä½ã€Œçµè«–ã€è€Œéã€Œæ™æ‰éç¨‹ã€ã€‚

- **Audit Log (ä¸Šå¸è¦–è§’)**ï¼šå‰‡æœƒå®Œæ•´ä¿ç•™æ‰€æœ‰å¤±æ•—ç´€éŒ„ä¾›ç ”ç©¶ç”¨ã€‚

### 3.6 é‚£ Thinking Rules (æ€è€ƒè¦å‰‡) å‘¢ï¼Ÿ

**Q: å¦‚æœæ˜¯æ€ç¶­è¢«ç³¾æ­£ï¼ˆä¾‹å¦‚ï¼šå¿˜äº†è€ƒæ…® PMT æ¨¡å‹ï¼‰ï¼Œæœƒè¢«è¨˜ä½å—ï¼Ÿ**
**A: åŒæ¨£é‚è¼¯ï¼šè¨˜ä½çµæœï¼Œå¿˜è¨˜ç³¾æ­£éç¨‹ã€‚**

- **ä¾‹å­**ï¼š
  1.  **Agent (Attempt 1)**: "æˆ‘è¦ºå¾—æ²’å·®ï¼Œä¸åšäº‹ã€‚" (é•åè¦å‰‡ï¼šæœªè©•ä¼°å¨è„…)
  2.  **Validator**: "éŒ¯èª¤ï¼šä½ å¿…é ˆæ ¹æ“š PMT æ¨¡å‹è©•ä¼°å¨è„…æ„Ÿèˆ‡æ‡‰å°èƒ½åŠ›ã€‚"
  3.  **Agent (Attempt 2)**: "å¥½å§ï¼Œæ ¹æ“š PMTï¼Œæ´ªæ°´å¨è„…å¾ˆé«˜ï¼Œä½†æˆ‘æ²’éŒ¢ï¼Œæ‰€ä»¥æˆ‘æ„Ÿåˆ°ç„¡åŠ©ã€‚" (åˆè¦)
- **é•·æœŸè¨˜æ†¶**ï¼š
  - ç³»çµ±åªæœƒå­˜å…¥ **Attempt 2**ï¼šã€Œå³ä½¿å¨è„…å¾ˆé«˜ï¼Œæˆ‘å› ç¼ºéŒ¢è€Œæ„Ÿåˆ°ç„¡åŠ©ã€‚ã€
  - **çµæœ**ï¼šæœªä¾†çš„ä»£ç†äººå›é¡§æ­·å²æ™‚ï¼Œæœƒè¦ºå¾—è‡ªå·±ã€Œä¸€ç›´éƒ½å¾ˆç†æ€§ä¸”ç¬¦åˆ PMTã€ï¼Œè€Œä¸çŸ¥é“è‡ªå·±å…¶å¯¦æ˜¯è¢«å¼·è¿«ä¿®æ­£çš„ã€‚é€™å°±æ˜¯æˆ‘å€‘å¦‚ä½•**å¡‘é€  (Shape)** ä»£ç†äººæ€§æ ¼çš„æ–¹å¼ã€‚

#### ç¬¬ä¸‰å¹•ï¼šéºå¿˜èˆ‡æª¢ç´¢ (Year 5) - é•·æœŸè¨˜æ†¶å–ç”¨

- ç¾åœ¨æ˜¯ç¬¬ 5 å¹´ï¼Œæ˜¯ä¸€å€‹æ™´æœ—çš„æ—¥å­ã€‚ä»£ç†äººæ­£åœ¨æ±ºå®šæ˜¯å¦è²·ä¿éšªã€‚
- **æª¢ç´¢å¼•æ“å•Ÿå‹•**ï¼š
  - å®ƒæŸ¥çœ‹ JSON ä¸­çš„æ•¸ç™¾æ¢ç´€éŒ„ã€‚
  - **è¨ˆç®—è¡°æ¸›**ï¼š$Score = I \times e^{-0.1 \times 3 \text{years}}$ã€‚
  - ç¬¬ 4 å¹´çš„ã€Œæ™´å¤©è¨˜æ†¶ã€($I=0.1$) è¡°æ¸›åˆ°è¶¨è¿‘ 0 -> **è¢«éæ¿¾æ‰**ã€‚
  - ç¬¬ 2 å¹´çš„ã€Œæ´ªæ°´äº‹å¯¦ (Path A)ã€($I=1.0$) é›–ç„¶è¡°æ¸›ï¼Œä½†åˆ†æ•¸ä»é«˜ -> **è¢«é¸ä¸­**ã€‚
  - ç¬¬ 2 å¹´çš„ã€Œåæ€å¿ƒå¾— (Path B)ã€($I=10.0$) åˆ†æ•¸ä¾ç„¶æ¥µé«˜ -> **è¢«é¸ä¸­**ã€‚
- **æœ€çµ‚ Prompt (Context)**ï¼š
  ç³»çµ±å°‡é€™å…©æ¢èˆŠè¨˜æ†¶ã€Œæ³¨å…¥ã€åˆ°ç¬¬ 5 å¹´çš„ Prompt ä¸­ï¼š
  > "You recall that in Year 2, a flood caused $50k damage." (Path A)
  > "Deep down, you know that without elevation, you will go bankrupt." (Path B)
  > "Current Status: It is sunny."

**çµæœ**ï¼šå³ä½¿ç¾åœ¨æ˜¯æ™´å¤©ï¼Œä»£ç†äººè®€åˆ°é€™äº›ã€Œæ³¨å…¥çš„èˆŠè¨˜æ†¶ã€ï¼Œæ±ºå®šè³¼è²·ä¿éšªã€‚é€™å°±æ˜¯è¨˜æ†¶ç³»çµ±é‹ä½œçš„å…¨è²Œã€‚

---

## 3. âš™ï¸ é…ç½®èˆ‡åƒæ•¸æŒ‡å— (Configuration & Parameters)

é‡å° Llama 3 / Gemma ç­‰æ¨¡å‹çš„å»ºè­°è¨­å®šã€‚

### æƒ…æ„Ÿèˆ‡ä¾†æºæ¬Šé‡ (Keywords & Weights)

ç”¨æˆ¶å¯é€šé `agent_types.yaml` è‡ªå®šç¾©æƒ…æ„Ÿé—œéµå­—èˆ‡ä¾†æºæ¬Šé‡ï¼Œé€™ç›´æ¥å½±éŸ¿ $Imp(m)$ çš„è¨ˆç®—ã€‚

| é¡åˆ¥ (Category)     | é—œéµå­—ç¯„ä¾‹                  | æ¬Šé‡ (Weight)       |
| :------------------ | :-------------------------- | :------------------ |
| **Direct Impact**   | `flood`, `damage`, `trauma` | **1.0** (æœ€é«˜/å‰µå‚·) |
| **Personal Source** | `i`, `my`, `me`             | **1.0** (è¦ªèº«ç¶“æ­·)  |
| **Strategic**       | `decision`, `relocate`      | **0.8**             |
| **Neighbor**        | `neighbor`, `others`        | **0.8**             |
| **Routine**         | (default)                   | **0.1**             |

### ä¸€èˆ¬åƒæ•¸ (General Parameters)

| åƒæ•¸                            | é¡å‹    | é è¨­å€¼ | èªªæ˜                      |
| :------------------------------ | :------ | :----- | :------------------------ |
| `window_size`                   | `int`   | `5`    | ã€Œå·¥ä½œè¨˜æ†¶ã€ä¸­çš„é …ç›®æ•¸ã€‚  |
| `decay_rate` ($\lambda_{base}$) | `float` | `0.1`  | åŸºç¤éºå¿˜ç‡ã€‚              |
| `importance_boost`              | `float` | `0.9`  | **åæ€æ´å¯Ÿ** çš„æ¬Šé‡ä¹˜æ•¸ã€‚ |

---

## 4. ğŸ”Œ ä½¿ç”¨èˆ‡é€£æ¥å™¨æŒ‡å— (Usage & Connector Guide)

å¦‚ä½•åœ¨æ‚¨çš„å¯¦é©—è…³æœ¬ (`run.py`) ä¸­å¯¦ä¾‹åŒ–ä¸¦é€£æ¥çµ„ä»¶ã€‚

```python
# 1. åˆå§‹åŒ–å¼•æ“
memory_engine = HumanCentricMemoryEngine(
    window_size=5,
    top_k_significant=2,
    consolidation_prob=0.7
)

# 2. é€£çµåˆ°ä¸Šä¸‹æ–‡å»ºæ§‹å™¨
# ContextBuilder æœƒåœ¨ 'build()' æ­¥é©Ÿä¸­è‡ªå‹•è§¸ç™¼æª¢ç´¢
ctx_builder = FinalContextBuilder(
    memory_engine=memory_engine,
    agent_id=agent.id
)

# 3. ä¸»è¿´åœˆæ•´åˆ
observation = ctx_builder.build(
    agent=agent,
    world_state=flood_depth
)
# 'observation' ç¾åœ¨åŒ…å«æ³¨å…¥çš„è¨˜æ†¶ + ç•¶å‰ç‹€æ…‹
```

---

## 5. ğŸ“ è¼¸å…¥/è¼¸å‡ºç¯„ä¾‹ (Input / Output Examples)

Prompt å…§éƒ¨ç©¶ç«Ÿç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿ

**è¼¸å…¥ï¼šåŸå§‹è¨˜æ†¶åº«**

```json
[
  { "year": 2, "text": "æ´ªæ°´æ‘§æ¯€æˆ¿å±‹ã€‚å‰µå‚·æ¥µé«˜ã€‚", "importance": 1.0 },
  { "year": 8, "text": "æ™´å¤©ã€‚", "importance": 0.1 }
]
```

**éç¨‹ï¼šç¬¬ 10 å¹´æª¢ç´¢**

- ç¬¬ 8 å¹´è¢«éºå¿˜ (è¡°æ¸›)ã€‚
- ç¬¬ 2 å¹´ **è¢«æª¢ç´¢** (é«˜é‡è¦æ€§æˆ°å‹äº†è¡°æ¸›)ã€‚

**è¼¸å‡ºï¼šæ³¨å…¥å¾Œçš„ä¸Šä¸‹æ–‡**

```text
[Your History]
- Recurring Memory: "æ´ªæ°´æ‘§æ¯€æˆ¿å±‹..." (ç¬¬ 2 å¹´)
[Current Situation]
- "ç›®å‰æ­£åœ¨ä¸‹å¤§é›¨ã€‚"
```
