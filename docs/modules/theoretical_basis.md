# Theoretical Basis & Architecture Master Map

![Cognitive Architecture Diagram](/c:/Users/wenyu/.gemini/antigravity/brain/9793af22-8e51-4316-9d6b-59ba45b8fe7a/cognitive_architecture_diagram_1768778927249.png)

This document bridges the gap between **Behavioral Theory** and **Software Engineering**. It details the academic foundations of the framework and maps them to specific code modules.

**Recommended for**: Researchers writing the "Methodology" section of their paper.

---

## 1. Dictionary of Concepts

### 1.1 Availability Heuristic

- **Theory**: Humans judge the probability of an event by how easily they can recall it (Tversky & Kahneman, 1973). Traumatic events are recalled vividly, leading to "Rational Bias."
- **Implementation**: `HumanCentricMemoryEngine` (in `broker/components/memory_engine.py`).
- **Mechanism**:
  - **Importance Scoring**: Keywords like "Flood" trigger high scores ($I=1.5$).
  - **Exponential Decay**: $S = I \times e^{-\lambda t}$. High-importance memories decay slower, remaining "available" for years.

### 1.2 Configurable Reasoning Logic (e.g., PMT)

- **Theory Context**: In our current flood simulation, we use **Protection Motivation Theory (PMT)** (Rogers, 1975).
- **Generalizability**: This module is a **"Theory Slot"**. It is not hardcoded to PMT.
  - **Behavioral Finance**: Can be properly configured to implement **Prospect Theory** (Kahneman & Tversky, 1979), ensuring agents weigh losses heavier than gains.
  - **Health**: Can implement **Health Belief Model (HBM)**.
- **Implementation**: `AgentValidator` (Dual-Tier Validation).
- **Mechanism**: The `thinking_rules` in YAML define the "Required Logic Structure". If the agent fails to use the specified theory (e.g., fails to mention "Loss Aversion"), the Validator blocks the action.

### 1.3 Bounded Rationality

- **Theory**: Agents are rational only within limits of information and cognition. They need constraints to act optimally (Simon, 1957).
- **Implementation**: **Governance Layer**.
- **Mechanism**: The framework acts as the "Bound," filtering out hallucinations and forcing the agent to focus on relevant variables.

### 1.4 Reflexion (Meta-Cognition)

- **Theory**: Learning occurs not just through doing, but through reflecting on past actions (Shinn et al., 2023).
- **Implementation**: `ReflectionEngine` (in `broker/components/reflection_engine.py`).
- **Mechanism**:
  - **Path A (Experience)**: Raw logs of daily events.
  - **Path B (Insight)**: Yearly summaries generated by the LLM ("I realized that X..."). These become **Semantic Memory**.

---

## 2. Theory-to-Code Mapping

| Theory                     | Module                 | File                   | Function                                     |
| :------------------------- | :--------------------- | :--------------------- | :------------------------------------------- |
| **Availability Heuristic** | **Memory Engine**      | `memory_engine.py`     | Heuristic Retrieval ($S = I e^{-\lambda t}$) |
| **PMT**                    | **Thinking Validator** | `agent_validator.py`   | Logic Constraints (`thinking_rules`)         |
| **Episodic Memory**        | **Simulation Logger**  | `experiment.py`        | Raw Event Logging (Path A)                   |
| **Semantic Memory**        | **Reflection Engine**  | `reflection_engine.py` | Insight Generation (Path B)                  |
| **Context Window**         | **Context Builder**    | `context_builder.py`   | Prompt Engineering                           |

---

## 3. System Workflow (The Cognitive Cycle)

The following lifecycle demonstrates how these theories interact in a single simulation step:

### Step 1: Perception (Availability Heuristic)

- **Context**: Year 5, Raining.
- **Retrieval**: The engine scans memory.
  - _Result_: A 3-year-old "Flood Trauma" ($I=1.5$) is retrieved because its decay-adjusted score ($1.1$) is higher than recent mundane events.
  - _Effect_: The agent "remembers the pain" clearly.

### Step 2: Reasoning (PMT & Bounded Rationality)

- **Prompt**: "You are Agent 001. It is raining. You recall the Year 2 disaster."
- **Cycle**:
  1.  **Draft 1**: "I ignore it." -> **BLOCKED** by Validator (Violates PMT: Ignored Threat).
  2.  **Retry**: "Because of the Year 2 disaster (Threat), I must act. I have savings (Coping)." -> **APPROVED**.

### Step 3: Action & Encoding (Episodic)

- **Action**: `buy_insurance`.
- **Encoding (Path A)**: "Year 5: Bought insurance." -> Saved to Raw Log.

### Step 4: Reflection (Reflexion / Semantic)

- **End of Year**: The agent reviews its logs.
- **Synthesis (Path B)**: "I learned that proactive spending prevents bankruptcy."
- **Result**: This **Insight** is stored as high-priority Semantic Memory for the future.

---

## 4. Universality & Domain Adaptation

The framework is a **Cognitive Middleware**, adaptable to any domain by changing the configuration (`agent_types.yaml`), not the code.

| Layer              | Socio-Hydrology (Current)  | Consumer Behavior           | Behavioral Finance                  |
| :----------------- | :------------------------- | :-------------------------- | :---------------------------------- |
| **Theory**         | **PMT** (Threat vs Coping) | **TPB** (Attitude vs Norms) | **Prospect Theory** (Loss Aversion) |
| **Trauma/Trigger** | `["flood", "damage"]`      | `["scam", "waste"]`         | `["market crash", "loss"]`          |
| **Logic Rule**     | "Evaluate Threat Level"    | "Evaluate Social Norms"     | "Compare to Reference Point"        |
| **Social Signal**  | Neighbor Elevation Rate    | Viral Product Review        | Market Sentiment / FOMO             |

This demonstrates the framework's capacity to model **any boundedly rational human behavior**, from buying insurance to stock trading.
