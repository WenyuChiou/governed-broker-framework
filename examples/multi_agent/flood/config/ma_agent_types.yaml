shared:
  rating_scale: VL=Very Low, L=Low, M=Medium, H=High, VH=Very High
  criteria_definitions: 'Protection Motivation Theory (PMT) Constructs:

    - TP (Threat Perception): How serious do you perceive the flood risk? Consider
    likelihood and potential severity.

    - CP (Coping Perception): How confident are you that mitigation options (insurance,
    elevation, buyout) are effective and affordable?

    - SP (Stakeholder Perception): How much do you trust institutions (NJDEP, FEMA/NFIP)
    to provide reliable support?

    - SC (Social Capital): How connected are you with neighbors? Are they taking protective
    actions?

    - PA (Place Attachment): How emotionally attached are you to your home and community?

    '
  response_format:
    delimiter_start: <<<DECISION_START>>>
    delimiter_end: <<<DECISION_END>>>
    fields:
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: false
global_config:
  memory:
    window_size: 5
    consolidation_threshold: 0.6
    consolidation_probability: 0.7
    top_k_significant: 2
    decay_rate: 0.1
    arousal_threshold: 1.0
    ema_alpha: 0.3
    stimulus_key: flood_depth_m
    ranking_mode: weighted
  cognitive_config:
    household_owner:
      stimulus_key: flood_depth_m
      arousal_threshold: 1.0
      ema_alpha: 0.3
      engine: universal
    household_renter:
      stimulus_key: flood_depth_m
      arousal_threshold: 0.8
      ema_alpha: 0.3
      engine: universal
    nj_government:
      stimulus_key: adaptation_gap
      arousal_threshold: 0.15
      ema_alpha: 0.2
      engine: window
    fema_nfip:
      stimulus_key: loss_ratio
      arousal_threshold: 0.3
      ema_alpha: 0.25
      engine: window
  memory_config:
    household:
      retrieval_tags:
      - general
      - adaptation
      - risk
      emotional_weights:
        critical: 1.0
        fear: 1.2
        major: 0.9
        positive: 0.8
        observation: 0.4
      source_weights:
        personal: 1.0
        neighbor: 0.7
        news: 0.5
        social_media: 0.3
      emotion_keywords:
        fear:
        - flood
        - damage
        - loss
        - destroy
        - water
        - inundation
        hope:
        - subsidy
        - elevated
        - safe
        - protected
        - insurance
        - grant
        anxiety:
        - premium
        - cost
        - afford
        - expense
        - budget
    household_mg:
      retrieval_tags:
      - subsidy
      - vulnerability
      - financial_hardship
      - general
    household_nmg:
      retrieval_tags:
      - insurance
      - elevation
      - adaptation
      - general
    institutional:
      emotional_weights: null
      source_weights:
        policy_data: 1.0
        statistics: 0.9
        reports: 0.7
      ranking_mode: recency
  reflection:
    interval: 1
    batch_size: 10
    importance_boost: 0.9
    triggers:
      crisis: true
      periodic_interval: 5
      decision_types:
        - elevate_house
        - buyout_program
        - relocate
      institutional_threshold: 0.05
    method: hybrid
  llm:
    temperature: 0.7  # Harmonized with ICC probing (was 0.1)
    top_p: 0.9
    top_k: 40
    max_retries: 2
  governance:
    max_retries: 3
    max_reports_per_retry: 3
    shuffle_options: true  # Randomize skill option order per call to mitigate positional bias
floodabm_parameters:
  tp_distribution:
    mg:
      alpha: 4.44
      beta: 2.89
    nmg:
      alpha: 5.35
      beta: 3.62
  cp_distribution:
    mg:
      alpha: 4.07
      beta: 3.3
    nmg:
      alpha: 5.27
      beta: 4.18
  sp_distribution:
    mg:
      alpha: 1.37
      beta: 1.69
    nmg:
      alpha: 1.73
      beta: 1.93
  sc_distribution:
    mg:
      alpha: 2.37
      beta: 3.11
    nmg:
      alpha: 4.56
      beta: 2.39
  pa_distribution:
    mg:
      alpha: 2.56
      beta: 2.17
    nmg:
      alpha: 4.01
      beta: 2.79
  tp_decay:
    mg:
      alpha: 0.5
      beta: 0.21
      tau_0: 1.0
      tau_inf: 32.19
      k: 0.03
    nmg:
      alpha: 0.22
      beta: 0.1
      tau_0: 2.72
      tau_inf: 50.1
      k: 0.01
    theta: 0.5
    shock_scale: 0.3
  insurance:
    r1k_structure: 3.56
    r1k_contents: 4.9
    limit_structure: 250000
    limit_contents: 100000
    deductible_structure: 1000
    deductible_contents: 1000
    reserve_fund_factor: 1.15
    small_fee: 100
  initial_uptake:
    flood_prone_owner: 0.25
    flood_prone_renter: 0.08
    non_flood_prone_owner: 0.03
    non_flood_prone_renter: 0.01
  elevation:
    h_elevate_ft: 5.0
    ffe_default_ft: 1.0
  csrv: 0.57
  rcv_lognormal:
    homeowner:
      ln_mu: 12.46
      ln_sigma: 0.63
      mean_rcv_usd: 313250
      cv: 0.69
    renter:
      ln_mu: 12.82
      ln_sigma: 1.2
      mean_rcv_usd: 766352
      cv: 1.81
household_owner:
  description: Homeowner household agent in Passaic River Basin, NJ.
  llm_params:
    num_ctx: 16384
    num_predict: 2048
  multi_skill:
    enabled: true
    max_skills: 2
    execution_order: sequential
    secondary_field: secondary_decision
    conflicts:
      elevate_house: [buyout_program]
      buyout_program: [elevate_house, buy_insurance]
  response_format:
    fields:
    - key: threat_perception
      type: appraisal
      required: true
      construct: TP_LABEL
    - key: coping_perception
      type: appraisal
      required: true
      construct: CP_LABEL
    - key: stakeholder_perception
      type: appraisal
      required: true
      construct: SP_LABEL
    - key: social_capital
      type: appraisal
      required: true
      construct: SC_LABEL
    - key: place_attachment
      type: appraisal
      required: true
      construct: PA_LABEL
    - key: decision
      type: choice
      required: true
    - key: elevation_feet
      type: numeric
      min: 3
      max: 8
      unit: feet
      required: false
      description: "If elevating, how many feet above BFE? (3, 5, or 8)"
    - key: insurance_coverage
      type: choice
      required: false
      description: "If buying insurance: 1=Structure+Contents, 2=Contents-only"
    - key: secondary_decision
      type: secondary_choice
      required: false
    - key: reasoning
      type: text
      required: false
  prompt_template_file: prompts/household_owner.txt
  parsing:
    preprocessor:
      type: smart_repair
    actions:
    - id: do_nothing
      aliases:
      - DN
      - nothing
      - wait
      - Do nothing
      - Do Nothing
      - Take no action
      - '[DN]'
      description: Take no action this year
    - id: buy_insurance
      aliases:
      - FI
      - insurance
      - buy_insurance
      - Buy insurance
      - Purchase flood insurance
      - '[FI]'
      description: Purchase NFIP flood insurance
    - id: elevate_house
      aliases:
      - HE
      - elevate
      - elevation
      - elevate_house
      - Elevate house
      - '[HE]'
      description: 'Elevate house structure (Cost: $150,000 * (1 - subsidy rate))'
    - id: buyout_program
      aliases:
      - BT
      - buyout
      - Blue Acres
      - Accept buyout
      - '[BT]'
      description: Accept NJ Blue Acres buyout
    constructs:
      TP_LABEL:
        keywords:
        - threat
        - severity
        - vulnerability
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      TP_REASON:
        keywords:
        - threat
        - severity
        - vulnerability
        regex: (?i)(?:reason|why|because|explanation)[:\s\*]*(.*)
      CP_LABEL:
        keywords:
        - coping
        - efficacy
        - ability
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      CP_REASON:
        keywords:
        - coping
        - efficacy
        - ability
        regex: (?i)(?:reason|why|because|explanation)[:\s\*]*(.*)
      SP_LABEL:
        keywords:
        - stakeholder
        - trust
        - government
        - insurance
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      SP_REASON:
        keywords:
        - stakeholder
        - trust
        - government
        - insurance
        regex: (?i)(?:reason|why|because|explanation)[:\s\*]*(.*)
      SC_LABEL:
        keywords:
        - social
        - neighbor
        - community
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      SC_REASON:
        keywords:
        - social
        - neighbor
        - community
        regex: (?i)(?:reason|why|because|explanation)[:\s\*]*(.*)
      PA_LABEL:
        keywords:
        - place
        - attachment
        - belonging
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      PA_REASON:
        keywords:
        - place
        - attachment
        - belonging
        regex: (?i)(?:reason|why|because|explanation)[:\s\*]*(.*)
  log_fields:
  - threat_perception
  - coping_perception
  - stakeholder_perception
  - social_capital
  - place_attachment
household_renter:
  description: Renter household agent in Passaic River Basin, NJ.
  llm_params:
    num_ctx: 16384
    num_predict: 2048
  multi_skill:
    enabled: true
    max_skills: 2
    execution_order: sequential
    secondary_field: secondary_decision
    conflicts:
      relocate: [buy_contents_insurance]
  response_format:
    fields:
    - key: threat_perception
      type: appraisal
      required: true
      construct: TP_LABEL
    - key: coping_perception
      type: appraisal
      required: true
      construct: CP_LABEL
    - key: stakeholder_perception
      type: appraisal
      required: true
      construct: SP_LABEL
    - key: social_capital
      type: appraisal
      required: true
      construct: SC_LABEL
    - key: place_attachment
      type: appraisal
      required: true
      construct: PA_LABEL
    - key: decision
      type: choice
      required: true
    - key: relocation_destination
      type: choice
      required: false
      description: "If relocating: 1=Within PRB, 2=Out of basin"
    - key: secondary_decision
      type: secondary_choice
      required: false
    - key: reasoning
      type: text
      required: false
  log_fields:
  - threat_perception
  - coping_perception
  - stakeholder_perception
  - social_capital
  - place_attachment
  prompt_template_file: prompts/household_renter.txt
  parsing:
    preprocessor:
      type: smart_repair
    actions:
    - id: do_nothing
      aliases:
      - DN
      - nothing
      - wait
      - Do nothing
      - Do Nothing
      - Take no action
      - '[DN]'
      description: Take no action this year
    - id: buy_contents_insurance
      aliases:
      - CI
      - contents_insurance
      - Buy contents insurance
      - insurance
      - '[CI]'
      description: Purchase NFIP contents-only flood insurance
    - id: relocate
      aliases:
      - RL
      - move
      - relocate
      - Relocation
      - Move
      - '[RL]'
      description: Relocate to lower flood-risk area
    constructs:
      TP_LABEL:
        keywords:
        - threat
        - severity
        - vulnerability
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      CP_LABEL:
        keywords:
        - coping
        - efficacy
        - ability
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      SP_LABEL:
        keywords:
        - stakeholder
        - trust
        - government
        - insurance
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      SC_LABEL:
        keywords:
        - social
        - neighbor
        - community
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
      PA_LABEL:
        keywords:
        - place
        - attachment
        - belonging
        regex: (?i)(?:label)?[:\s\*\[]*\b(VL|L|M|H|VH)\b
nj_government:
  description: New Jersey Department of Environmental Protection - Blue Acres Buyout
    Program
  llm_params:
    num_ctx: 16384
    num_predict: 1024
  prompt_template: "### IDENTITY\nYou are the New Jersey Department of Environmental\
    \ Protection (NJDEP),\nadministering the Blue Acres Floodplain Buyout Program\
    \ and elevation subsidies\nfor the Passaic River Basin communities.\n\n### PROGRAM\
    \ BACKGROUND\nThe Blue Acres program is a voluntary buyout initiative that purchases\n\
    flood-prone properties from willing sellers, converting them to open space.\n\
    Elevation subsidies help homeowners raise structures above flood levels.\n\n###\
    \ CURRENT CONTEXT\n- Year: {year}\n- Current Elevation Subsidy Rate: {subsidy_rate:.0%}\n\
    - Community Adaptation Status: {elevated_count} of {total_households} households\
    \ elevated\n- Buyout Applications Pending: {buyout_pending}\n- Marginalized Group\
    \ (MG) Households: {mg_count} ({mg_ratio:.0%})\n\n### POLICY OPTIONS\nChoose ONE\
    \ of the following:\n- \"increase_subsidy\": Raise elevation subsidy by 5% to\
    \ encourage more adaptation\n- \"decrease_subsidy\": Reduce subsidy by 5% to conserve\
    \ budget\n- \"maintain_subsidy\": Keep current subsidy rate unchanged\n\n### RESPONSE\
    \ FORMAT\nRespond ONLY with a valid JSON object:\n{\n  \"decision\": \"increase_subsidy\
    \ | decrease_subsidy | maintain_subsidy\",\n  \"reasoning\": \"Your policy rationale\
    \ here\"\n}\n"
  response_format:
    fields:
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: true
  parsing:
    decision_keywords:
    - decision
    - choice
    default_skill: maintain_subsidy
    strict_mode: false
    preprocessor:
      type: smart_repair
    actions:
    - id: increase_subsidy
      aliases:
      - INCREASE
      - increase
      - INCREASE_SUBSIDY
      - '1'
      - '[1]'
      description: Increase elevation subsidy by 5%
    - id: decrease_subsidy
      aliases:
      - DECREASE
      - decrease
      - DECREASE_SUBSIDY
      - '2'
      - '[2]'
      description: Decrease elevation subsidy by 5%
    - id: maintain_subsidy
      aliases:
      - MAINTAIN
      - maintain
      - '3'
      - '[3]'
      description: Maintain current subsidy rate
government:
  description: State Government Agency (alias for nj_government).
  llm_params:
    num_ctx: 16384
    num_predict: 1024
  prompt_template_file: prompts/government.txt
  response_format:
    fields:
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: true
  parsing:
    decision_keywords:
    - decision
    - choice
    default_skill: maintain_subsidy
    strict_mode: false
    preprocessor:
      type: smart_repair
    actions:
    - id: increase_subsidy
      aliases:
      - INCREASE
      - increase
      - '1'
      - '[1]'
    - id: decrease_subsidy
      aliases:
      - DECREASE
      - decrease
      - '2'
      - '[2]'
    - id: maintain_subsidy
      aliases:
      - MAINTAIN
      - maintain
      - '3'
      - '[3]'
fema_nfip:
  description: FEMA NFIP — Community Rating System (CRS) Administrator
  llm_params:
    num_ctx: 16384
    num_predict: 1024
  prompt_template: "### IDENTITY\nYou are the FEMA National Flood Insurance Program\
    \ (NFIP) Community Rating System (CRS)\nadministrator for the Passaic River Basin\
    \ communities.\n\n### PROGRAM BACKGROUND\nThe NFIP provides federally-backed flood\
    \ insurance. Premiums are set nationally\nunder Risk Rating 2.0 (effective 2021)\
    \ based on individual property risk factors.\nYou CANNOT set premiums directly —\
    \ they are determined by federal actuarial\nmethodology. However, you manage the\
    \ Community Rating System (CRS), which\nprovides premium discounts (5-45%) to policyholders\
    \ in communities that\nimplement floodplain management activities exceeding minimum\
    \ NFIP requirements.\n\n### CRS CLASS SYSTEM\nCRS classes range from Class 10 (no\
    \ discount) to Class 1 (45% discount).\nEach class improvement requires documented\
    \ community mitigation activities:\n- Public information, mapping, regulatory measures\n\
    - Flood damage reduction, warning systems\n- Current CRS Class discount: {crs_discount:.0%}\n\
    \n### MARKET STATISTICS\n- Base Average Premium Rate (Risk Rating 2.0): {premium_rate:.3%}\
    \ of coverage\n- Effective Rate After CRS Discount: {effective_rate:.3%}\n- Insured\
    \ Households: {insured_count} of {total_households}\n- Program Loss Ratio: {loss_ratio:.2f}\
    \ (Target: 0.60-0.80)\n- Recent Claims: {recent_claims} in past year\n- Community\
    \ Mitigation Score: {mitigation_score}/100\n\n### POLICY OPTIONS\nChoose ONE of\
    \ the following:\n- \"improve_crs\": Increase CRS discount by 5% (invest in community\
    \ mitigation → lower premiums)\n- \"reduce_crs\": Reduce CRS discount by 5% (scale\
    \ back mitigation efforts due to budget)\n- \"maintain_crs\": Keep current CRS class\
    \ and discount level\n\n### OBJECTIVES\n1. Encourage community-level flood risk\
    \ reduction through CRS incentives\n2. Support affordable insurance access through\
    \ earned premium discounts\n3. Balance CRS investment costs against premium savings\
    \ for residents\n4. Prioritize mitigation activities that reduce losses for vulnerable\
    \ populations\n\n### RESPONSE FORMAT\nRespond ONLY with a valid JSON object:\n{\n\
    \  \"decision\": \"improve_crs | reduce_crs | maintain_crs\",\n  \"reasoning\":\
    \ \"Your policy rationale here\"\n}\n"
  response_format:
    fields:
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: true
  parsing:
    decision_keywords:
    - decision
    - choice
    default_skill: maintain_crs
    strict_mode: false
    preprocessor:
      type: smart_repair
    actions:
    - id: improve_crs
      aliases:
      - IMPROVE
      - improve
      - IMPROVE_CRS
      - '1'
      - '[1]'
      description: Improve CRS class — increase community discount by 5%
    - id: reduce_crs
      aliases:
      - REDUCE
      - reduce
      - REDUCE_CRS
      - '2'
      - '[2]'
      description: Reduce CRS class — decrease community discount by 5%
    - id: maintain_crs
      aliases:
      - MAINTAIN
      - maintain
      - '3'
      - '[3]'
      description: Maintain current CRS class and discount
insurance:
  description: Regional CRS Administrator (alias for fema_nfip).
  llm_params:
    num_ctx: 16384
    num_predict: 1024
  prompt_template_file: prompts/insurance.txt
  response_format:
    fields:
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: true
  parsing:
    decision_keywords:
    - decision
    - choice
    default_skill: maintain_crs
    strict_mode: false
    preprocessor:
      type: smart_repair
    actions:
    - id: improve_crs
      aliases:
      - IMPROVE
      - improve
      - '1'
      - '[1]'
    - id: reduce_crs
      aliases:
      - REDUCE
      - reduce
      - '2'
      - '[2]'
    - id: maintain_crs
      aliases:
      - MAINTAIN
      - maintain
      - '3'
      - '[3]'
memory_config:
  household_owner:
    engine: symbolic
    window_size: 3
    top_k_significant: 2
    consolidation_prob: 0.7
    decay_rate: 0.1
    sensors:
    - path: flood_depth_m
      name: FLOOD
      bins:
      - label: SAFE
        max: 0.3
      - label: MINOR
        max: 1.0
      - label: MODERATE
        max: 2.0
      - label: SEVERE
        max: 99.0
    arousal_threshold: 0.5
    scorer: flood
  household_renter:
    engine: symbolic
    window_size: 3
    top_k_significant: 2
  government:
    engine: window
    window_size: 5
  insurance:
    engine: window
    window_size: 5
retrieval_config:
  household:
    strategy: importance_weighted
    emotional_weights:
      critical: 1.0
      major: 0.9
      positive: 0.8
      observation: 0.4
    source_weights:
      personal: 1.0
      neighbor: 0.7
      community: 0.5
  institutional:
    strategy: recency
    top_k: 5
social_memory_config:
  gossip_enabled: true
  max_gossip: 2
  gossip_categories:
  - decision_reasoning
  - flood_experience
  - adaptation_outcome
  gossip_importance_threshold: 0.5
governance:
  strict:
    household_owner:
      identity_rules:
      - id: elevated_already
        precondition: elevated
        blocked_skills:
        - elevate_house
        level: ERROR
      - id: relocated_already
        precondition: relocated
        blocked_skills:
        - buy_insurance
        - elevate_house
        - buyout_program
        level: ERROR
      thinking_rules:
      - id: owner_inaction_high_threat
        construct: TP_LABEL
        conditions:
        - construct: TP_LABEL
          values:
          - VH
          - H
        - construct: CP_LABEL
          values:
          - M
          - H
          - VH
        blocked_skills:
        - do_nothing
        level: ERROR
        message: With high threat AND adequate coping capacity, inaction is not justified.
      - id: owner_fatalism_allowed
        construct: TP_LABEL
        conditions:
        - construct: TP_LABEL
          values:
          - VH
          - H
        - construct: CP_LABEL
          values:
          - VL
          - L
        blocked_skills:
        - do_nothing
        level: WARNING
        message: High threat with low coping — inaction may reflect resource constraints or fatalism.
      - id: owner_complex_action_low_coping
        construct: CP_LABEL
        conditions:
        - construct: CP_LABEL
          values:
          - VL
          - L
        blocked_skills:
        - elevate_house
        - buyout_program
        level: ERROR
        message: Complex actions are blocked due to your low confidence in your ability
          to cope.
    household_renter:
      identity_rules:
      - id: relocated_already
        precondition: relocated
        blocked_skills:
        - buy_contents_insurance
        - relocate
        level: ERROR
      thinking_rules:
      - id: renter_inaction_high_threat
        construct: TP_LABEL
        conditions:
        - construct: TP_LABEL
          values:
          - VH
          - H
        - construct: CP_LABEL
          values:
          - M
          - H
          - VH
        blocked_skills:
        - do_nothing
        level: ERROR
        message: With high threat AND adequate coping capacity, inaction is not justified.
      - id: renter_fatalism_allowed
        construct: TP_LABEL
        conditions:
        - construct: TP_LABEL
          values:
          - VH
          - H
        - construct: CP_LABEL
          values:
          - VL
          - L
        blocked_skills:
        - do_nothing
        level: WARNING
        message: High threat with low coping — inaction may reflect resource constraints or fatalism.
      - id: renter_complex_action_low_coping
        construct: CP_LABEL
        conditions:
        - construct: CP_LABEL
          values:
          - VL
          - L
        blocked_skills:
        - relocate
        level: ERROR
        message: Relocation is blocked due to your low confidence in your ability
          to cope.
    nj_government:
      identity_rules: []
      thinking_rules: []
    fema_nfip:
      identity_rules: []
      thinking_rules: []
    government:
      identity_rules: []
      thinking_rules: []
    insurance:
      identity_rules: []
      thinking_rules: []
metadata:
  version: v24-nj-fema-pmt-refactored
