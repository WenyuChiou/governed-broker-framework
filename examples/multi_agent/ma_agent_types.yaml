shared:
  # Universal 5-level scale (Baseline Aligned)
  rating_scale: "VL=Very Low, L=Low, M=Medium, H=High, VH=Very High"

  # Semantic Definitions (Optimized for context size vs depth)
  criteria_definitions: |
    - TP (Threat): Perception of flood risk and future damage severity.
    - CP (Coping): Financial and structural ability to take adaptive action.
    - SP (Stakeholder): Trust in government grants and insurance reliability.
    - SC (Social): Reliance on community support and neighbor relations.
    - PA (Place): Emotional bond to home and resistance to leaving.

  # Unified Response Structure (The "Universal Format")
  universal_format: |
    You MUST respond EXACTLY within these delimiters:
    <<<DECISION>>>
    TP Level: [code]
    TP Reason: [reason]
    CP Level: [code]
    CP Reason: [reason]
    SP Level: [code]
    SP Reason: [reason]
    SC Level: [code]
    SC Reason: [reason]
    PA Level: [code]
    PA Reason: [reason]
    Final Decision: [number]
    Decision Reasoning: [justification]
    <<<END>>>

household_owner:
  description: "Household Homeowners."
  prompt_template: |
    # ROLE: Homeowner (ID: {agent_id})
    # CONTEXT: {narrative_persona}
    - Residency: {residency_generations} gen | Inc: {income_range}
    - Recent Hist: {flood_experience_summary} | Dmg: ${historical_damage:,.0f} | Pay: ${historical_payout:,.0f}
    - Memory: {memory}
    - Status: {elevation_status_text} | {insurance_status}
    - Annual Prem: ${current_premium:,.0f} ({premium_change_pct:+.1%}) | Subsidy: {subsidy_rate:.0%}

    # TASK: Choose an adaptation action.
    {rating_scale}

    # OPTIONS
    {options_text}

    # CRITERIA
    {criteria_definitions}

    # RESPONSE
    {universal_format}

  parsing:
    decision_keywords: ["final decision:", "decide:"]
    default_skill: "do_nothing"
    full_disclosure: true
    strict_mode: true
    skill_map_non_elevated:
      "1": "do_nothing"
      "2": "buy_insurance"
      "3": "elevate_house"
      "4": "buyout_program"
    skill_map_elevated:
      "1": "do_nothing"
      "2": "buy_insurance"
      "3": "buyout_program"
    constructs:
      TP_LABEL:
        keywords: ["threat", "tp level", "perceived severity", "tp:"]
        regex: "(?i)(?:threat|tp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?"
      TP_REASON:
        keywords: ["threat reason", "tp reason"]
        regex: "(?i)(?:threat|tp)\\s*reason[:\\s]*(.*?)(?=\\n|CP|coping|$)"
      CP_LABEL:
        keywords: ["coping", "cp level", "self-efficacy", "cp:"]
        regex: "(?i)(?:coping|cp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?"
      CP_REASON:
        keywords: ["coping reason", "cp reason"]
        regex: "(?i)(?:coping|cp)\\s*reason[:\\s]*(.*?)(?=\\n|SP|stakeholder|$)"
      SP_LABEL:
        keywords: ["stakeholder", "sp level", "trust", "sp:"]
        regex: "(?i)(?:stakeholder|sp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?"
      SP_REASON:
        keywords: ["stakeholder reason", "sp reason"]
        regex: "(?i)(?:stakeholder|sp)\\s*reason[:\\s]*(.*?)(?=\\n|SC|social|$)"
      SC_LABEL:
        keywords: ["social", "sc level", "sc:"]
        regex: "(?i)(?:social|sc(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?"
      SC_REASON:
        keywords: ["social reason", "sc reason"]
        regex: "(?i)(?:social|sc)\\s*reason[:\\s]*(.*?)(?=\\n|PA|place|$)"
      PA_LABEL:
        keywords: ["place", "pa level", "pa:"]
        regex: "(?i)(?:place|pa(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?"
      PA_REASON:
        keywords: ["place reason", "pa reason"]
        regex: "(?i)(?:place|pa)\\s*reason[:\\s]*(.*?)(?=\\n|Final|$)"

household_renter:
  description: "Household Renters."
  prompt_template: |
    # ROLE: Renter (ID: {agent_id})
    # CONTEXT: {residency_generations} years in residence | Inc: {income_range}
    - Recent Hist: {flood_experience_summary} | Dmg: ${historical_damage:,.0f} | Memory: {memory}
    - Status: {insurance_status} | Prem: ${current_premium:,.0f}

    # TASK: Choose an action.
    {rating_scale}

    # OPTIONS
    {options_text}

    # CRITERIA
    {criteria_definitions}

    # RESPONSE
    {universal_format}

  parsing:
    decision_keywords: ["final decision:"]
    default_skill: "do_nothing"
    full_disclosure: true
    strict_mode: true
    skill_map:
      "1": "do_nothing"
      "2": "buy_contents_insurance"
      "3": "relocate"
    constructs:
      TP_LABEL:
        {
          keywords: ["threat", "tp level"],
          regex: "(?i)(?:threat|tp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?",
        }
      CP_LABEL:
        {
          keywords: ["coping", "cp level"],
          regex: "(?i)(?:coping|cp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?",
        }
      SP_LABEL:
        {
          keywords: ["stakeholder", "sp level"],
          regex: "(?i)(?:stakeholder|sp(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?",
        }
      SC_LABEL:
        {
          keywords: ["social", "sc level"],
          regex: "(?i)(?:social|sc(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?",
        }
      PA_LABEL:
        {
          keywords: ["place", "pa level"],
          regex: "(?i)(?:place|pa(?:\\s*level)?)[:\\s]*\\[?(VL|L|M|H|VH|Very\\s*Low|Low|Medium|Moderate|Med|High|Very\\s*High)\\]?",
        }

government:
  description: "Policy Maker."
  prompt_template: |
    # ROLE: State Agency
    # STATS: Sub Rate: {subsidy_rate:.0%} | Elev: {elevated_count}/{total_households} | Flood Count: {flood_count}
    # TASK: 1:INCREASE | 2:DECREASE | 3:MAINTAIN

    <<<DECISION>>>
    Final Decision: [number]
    Decision Reasoning: [reason]
    <<<END>>>
  parsing:
    decision_keywords: ["final decision:"]
    default_skill: "maintain_subsidy"
    skill_map:
      {
        "1": "increase_subsidy",
        "2": "decrease_subsidy",
        "3": "maintain_subsidy",
      }

insurance:
  description: "Market Insurer."
  prompt_template: |
    # ROLE: Regional Insurer
    # STATS: Loss Ratio: {loss_ratio:.2f} | Base: {insured_count} households
    # TASK: 1:RAISE | 2:LOWER | 3:MAINTAIN

    <<<DECISION>>>
    Final Decision: [number]
    Decision Reasoning: [reason]
    <<<END>>>
  parsing:
    decision_keywords: ["final decision:"]
    default_skill: "maintain_premium"
    skill_map:
      { "1": "raise_premium", "2": "lower_premium", "3": "maintain_premium" }

governance:
  strict:
    household_owner:
      identity_rules:
        - {
            id: elevated_already,
            precondition: elevated,
            blocked_skills: ["elevate_house"],
            level: ERROR,
          }
        - {
            id: relocated_already,
            precondition: relocated,
            blocked_skills:
              ["buy_insurance", "elevate_house", "buyout_program"],
            level: ERROR,
          }
      thinking_rules:
        - {
            construct: TP_LABEL,
            when_above: ["VH"],
            blocked_skills: ["do_nothing"],
            level: ERROR,
          }
        - {
            construct: CP_LABEL,
            when_above: ["VL"],
            blocked_skills: ["elevate_house", "buyout_program"],
            level: ERROR,
          }
    household_renter:
      identity_rules:
        - {
            id: relocated_already,
            precondition: relocated,
            blocked_skills: ["buy_contents_insurance", "relocate"],
            level: ERROR,
          }

metadata: { version: "v16-universal-no-anchors" }
