# Unified Flood Experiment - Agent Types Configuration
# Demonstrates Task-040 SA/MA Unified Architecture
#
# New features:
# - agent_types section with type_id, category, psychological_framework
# - Per-type eligible_skills
# - Per-type validation rules
# - Inheritance support (parent field)

# Global configuration
global_config:
  memory:
    engine_type: unified
    surprise_strategy: ema
    arousal_threshold: 0.5
    window_size: 5
    consolidation_threshold: 0.6
    emotional_weights:
      direct_impact: 1.0
      strategic_choice: 0.8
      efficacy_gain: 0.6
      social_feedback: 0.4
    source_weights:
      personal: 1.0
      neighbor: 0.8
      community: 0.6
    retrieval_weights:
      recency: 0.3
      importance: 0.5
      context: 0.2

  llm:
    temperature: 0.7
    max_tokens: 512

# Agent type definitions (NEW unified schema)
agent_types:
  # Base household type
  household:
    type_id: household
    category: household
    psychological_framework: pmt
    description: "Base household agent using PMT framework"

    constructs:
      TP_LABEL:
        name: "Threat Perception"
        values: ["VL", "L", "M", "H", "VH"]
        required: true
      CP_LABEL:
        name: "Coping Perception"
        values: ["VL", "L", "M", "H", "VH"]
        required: true
      SP_LABEL:
        name: "Stakeholder Perception"
        values: ["VL", "L", "M", "H", "VH"]
        required: false

    eligible_skills:
      - buy_insurance
      - elevate_house
      - buyout_program
      - relocate
      - do_nothing

    validation:
      identity_rules:
        - id: already_elevated
          precondition: elevated
          blocked_skills: [elevate_house]
          level: ERROR
          message: "House is already elevated"
        - id: already_relocated
          precondition: relocated
          blocked_skills: [relocate, elevate_house, buy_insurance]
          level: ERROR
          message: "Household has relocated"
      thinking_rules:
        - id: vh_threat_requires_action
          construct: TP_LABEL
          when_above: [VH]
          blocked_skills: [do_nothing]
          level: ERROR
          message: "Very high threat requires protective action"
        - id: low_tp_blocks_extreme
          construct: TP_LABEL
          when_above: [VL, L]
          blocked_skills: [relocate, elevate_house]
          level: ERROR
          message: "Low threat does not justify extreme measures"

    memory_config:
      engine: unified
      surprise_strategy: ema
      arousal_threshold: 0.5

  # Owner subtype (inherits from household)
  household_owner:
    type_id: household_owner
    category: household
    parent: household  # Inherits from household
    psychological_framework: pmt
    description: "Homeowner with full adaptation options"

    eligible_skills:
      - buy_insurance
      - elevate_house
      - buyout_program
      - relocate
      - do_nothing

  # Renter subtype (inherits from household, restricted skills)
  household_renter:
    type_id: household_renter
    category: household
    parent: household
    psychological_framework: pmt
    description: "Renter with limited adaptation options"

    eligible_skills:
      - buy_contents_insurance
      - relocate
      - do_nothing

    validation:
      identity_rules:
        - id: renter_no_elevate
          precondition: is_renter
          blocked_skills: [elevate_house, buyout_program]
          level: ERROR
          message: "Renters cannot modify property"

  # Government agent (MA only)
  government:
    type_id: government
    category: institutional
    psychological_framework: utility
    description: "Government agent for policy decisions"

    constructs:
      BUDGET_UTIL:
        name: "Budget Utility"
        values: ["DEFICIT", "NEUTRAL", "SURPLUS"]
        required: true
      EQUITY_GAP:
        name: "Equity Gap"
        values: ["HIGH", "MEDIUM", "LOW"]
        required: true
      ADOPTION_RATE:
        name: "Adoption Rate"
        values: ["LOW", "MEDIUM", "HIGH"]
        required: false

    eligible_skills:
      - increase_subsidy
      - decrease_subsidy
      - launch_campaign
      - maintain_policy
      - emergency_relief

    validation:
      thinking_rules:
        - id: deficit_limits_spending
          construct: BUDGET_UTIL
          when_above: [DEFICIT]
          blocked_skills: [increase_subsidy, emergency_relief]
          level: ERROR
          message: "Budget deficit limits spending options"

  # Insurance agent (MA only)
  insurance:
    type_id: insurance
    category: institutional
    psychological_framework: financial
    description: "Insurance company agent"

    constructs:
      LOSS_RATIO:
        name: "Loss Ratio"
        values: ["HIGH", "MEDIUM", "LOW"]
        required: true
      SOLVENCY:
        name: "Solvency"
        values: ["AT_RISK", "STABLE", "STRONG"]
        required: true
      MARKET_SHARE:
        name: "Market Share"
        values: ["DECLINING", "STABLE", "GROWING"]
        required: false

    eligible_skills:
      - raise_premium
      - lower_premium
      - expand_coverage
      - restrict_coverage
      - maintain_rates

    validation:
      thinking_rules:
        - id: at_risk_restricts_expansion
          construct: SOLVENCY
          when_above: [AT_RISK]
          blocked_skills: [expand_coverage, lower_premium]
          level: ERROR
          message: "At-risk solvency restricts expansion"

# Governance profiles (for backward compatibility)
governance:
  strict:
    thinking_rules:
      - id: extreme_threat_requires_action
        construct: TP_LABEL
        when_above: [VH]
        blocked_skills: [do_nothing]
        level: ERROR
        message: "Extreme threat requires adaptation action"
      - id: high_tp_cp_blocks_nothing
        conditions:
          - construct: TP_LABEL
            values: [H, VH]
          - construct: CP_LABEL
            values: [H, VH]
        blocked_skills: [do_nothing]
        level: ERROR
        message: "High threat + high coping should lead to action"
    identity_rules:
      - id: already_elevated
        precondition: elevated
        blocked_skills: [elevate_house]
        level: ERROR
        message: "Already elevated"
      - id: already_relocated
        precondition: relocated
        blocked_skills: [relocate, elevate_house, buy_insurance]
        level: ERROR
        message: "Already relocated"

  relaxed:
    thinking_rules:
      - id: extreme_threat_requires_action
        construct: TP_LABEL
        when_above: [VH]
        blocked_skills: [do_nothing]
        level: WARNING
        message: "Consider protective action for extreme threat"
    identity_rules:
      - id: already_elevated
        precondition: elevated
        blocked_skills: [elevate_house]
        level: ERROR
        message: "Already elevated"

  disabled:
    thinking_rules: []
    identity_rules: []

# Response format specification
response_format:
  delimiter_start: "<<<DECISION_START>>>"
  delimiter_end: "<<<DECISION_END>>>"
  json_mode: true
  fields:
    - key: threat_appraisal
      type: appraisal
      construct: TP_LABEL
      required: true
    - key: coping_appraisal
      type: appraisal
      construct: CP_LABEL
      required: true
    - key: decision
      type: choice
      required: true
    - key: reasoning
      type: text
      required: false

# Household prompt template
household:
  prompt_template: |
    You are a household in a flood-prone area making adaptation decisions.

    Your Profile:
    - Tenure: {tenure}
    - Income Level: {income_level}
    - Years in Home: {years_in_home}
    - Minority Group: {mg}

    Current Situation:
    - Year: {year}
    - Current State: {cumulative_state}
    - Recent Flood: {recent_flood}
    - Damage History: {damage_history}

    Recent Memories:
    {memory_context}

    Neighbor Information:
    {social_context}

    Available Actions:
    {available_skills}

    Based on Protection Motivation Theory:
    1. Assess your THREAT PERCEPTION (how serious is the flood risk?)
    2. Assess your COPING PERCEPTION (can you effectively protect yourself?)
    3. Make a DECISION from the available actions

    Respond in JSON format within the delimiters:
    <<<DECISION_START>>>
    {
      "threat_appraisal": "your threat assessment (VL/L/M/H/VH)",
      "coping_appraisal": "your coping assessment (VL/L/M/H/VH)",
      "decision": "your chosen action",
      "reasoning": "brief explanation"
    }
    <<<DECISION_END>>>
